
# PM2와 Node.js

PM2(Process Manager 2)는 Node.js 애플리케이션을 위한 프로덕션 프로세스 관리 도구입니다. PM2는 애플리케이션의 가용성과 안정성을 높이고, 부하 분산 및 로그 관리를 통해 개발자에게 편리한 환경을 제공합니다.

## 주요 특징

1. **무중단 서비스**: PM2는 클러스터 모드를 통해 Node.js 애플리케이션을 여러 CPU 코어에 분산 실행할 수 있습니다.
2. **자동 재시작**: 애플리케이션이 비정상적으로 종료될 경우 자동으로 재시작합니다.
3. **로드 밸런싱**: 클러스터 모드를 이용해 여러 코어에 작업을 분배하여 성능을 최적화합니다.
4. **로그 관리**: PM2는 애플리케이션의 로그를 중앙에서 관리하고, 파일로 저장하거나 외부 도구로 전송할 수 있습니다.
5. **모니터링**: 웹 기반 대시보드나 CLI를 통해 애플리케이션 상태를 실시간으로 모니터링할 수 있습니다.
6. **무중단 배포(Zero Downtime Deployment)**: PM2는 무중단 배포를 지원하여 사용자가 서비스 중단 없이 애플리케이션을 업데이트할 수 있습니다.

---

## 설치 및 기본 사용법

### PM2 설치

PM2는 Node.js 패키지 관리자인 npm을 통해 설치합니다:

```bash
npm install -g pm2
```

### 애플리케이션 실행

간단한 Node.js 애플리케이션을 예로 들어보겠습니다.

#### 1. 간단한 서버 생성 (`app.js`):

```javascript
const http = require('http');

const server = http.createServer((req, res) => {
  res.writeHead(200, { 'Content-Type': 'text/plain' });
  res.end('Hello, PM2!');
});

server.listen(3000, () => {
  console.log('Server running at http://localhost:3000/');
});
```

#### 2. PM2로 애플리케이션 실행:

```bash
pm2 start app.js
```

### 실행된 애플리케이션 확인

```bash
pm2 list
```

### 애플리케이션 재시작

```bash
pm2 restart app.js
```

### 애플리케이션 종료

```bash
pm2 stop app.js
```

---

## 클러스터 모드

PM2는 클러스터 모드를 통해 멀티코어 환경에서 애플리케이션 성능을 극대화할 수 있습니다.

```bash
pm2 start app.js -i max
```

위 명령은 사용 가능한 모든 CPU 코어에 애플리케이션을 실행합니다.

---

## 무중단 배포 (Zero Downtime Deployment)

PM2는 `reload` 명령을 통해 애플리케이션을 중단 없이 재배포할 수 있습니다. 이는 클러스터 모드에서 사용자가 요청을 처리하는 동안 각 프로세스를 순차적으로 재시작함으로써 이루어집니다.

### 무중단 배포 사용 예시

1. **배포 준비**: 기존 애플리케이션 실행

```bash
pm2 start app.js -i max
```

2. **코드 업데이트 후 재배포**:

```bash
pm2 reload app.js
```

`reload` 명령은 애플리케이션 프로세스를 순차적으로 재시작하여 요청 처리의 연속성을 보장합니다.

---

## 로그 관리

PM2는 로그 파일을 자동으로 생성합니다. 로그를 확인하려면 다음 명령을 사용하세요:

```bash
pm2 logs
```

---

## 모니터링

CLI를 통한 모니터링:

```bash
pm2 monit
```

PM2 Plus 대시보드(웹 기반 모니터링 도구)를 사용하면 실시간으로 애플리케이션 상태를 시각적으로 확인할 수 있습니다.

---

PM2는 Node.js 애플리케이션의 안정성과 효율성을 높이는 강력한 도구입니다. 특히 무중단 배포 기능은 프로덕션 환경에서 애플리케이션의 가용성을 극대화하는 데 필수적입니다.
