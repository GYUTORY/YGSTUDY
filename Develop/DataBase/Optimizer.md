# 옵티마이저 (Optimizer)
- 데이터베이스 관리 시스템(DBMS)의 핵심 엔진으로, SQL 쿼리를 가장 효율적으로 실행할 수 있는 최적의 처리 경로를 생성하는 역할을 수행
- 컴퓨터의 두뇌가 CPU인 것처럼 DBMS의 두뇌는 옵티마이저라고 할 수 있음
- 개발자가 SQL을 작성하고 실행하면 즉시 실행되는 것이 아니라, 옵티마이저가 실행 계획을 세우게 됨
- 옵티마이저는 크게 규칙 기반 옵티마이저(Rule-Based Optimizer)와 비용 기반 옵티마이저(Cost-Based Optimizer)로 구분됨

## 옵티마이저의 주요 기능과 역할

### 1. 쿼리 분석(Statement Parsing)
- SQL 문장의 문법 검사 및 의미 분석 수행
- 테이블, 컬럼, 인덱스 등의 데이터베이스 객체 존재 여부 확인
- 사용자 권한 검증
- SQL 문장의 구조를 파싱하여 내부 표현으로 변환
- 쿼리 트리(Query Tree) 생성

### 2. 실행 계획 생성(Execution Plan Generation)
- 다양한 실행 계획 후보군 생성
- 테이블 접근 방법 결정
  - 전체 테이블 스캔(Full Table Scan)
  - 인덱스 스캔(Index Scan)
  - 인덱스 범위 스캔(Index Range Scan)
  - 인덱스 고유 스캔(Index Unique Scan)
- 조인 방법 선택
  - 중첩 루프 조인(Nested Loop Join)
  - 해시 조인(Hash Join)
  - 정렬 병합 조인(Sort Merge Join)
- 조인 순서 최적화
- 서브쿼리 처리 방식 결정
  - 서브쿼리 언네스팅(Subquery Unnesting)
  - 서브쿼리 머지(Subquery Merging)
  - 서브쿼리 팩토링(Subquery Factoring)
- 인덱스 사용 여부 및 선택
- 정렬 및 그룹화 방법 결정

### 3. 실행 계획 평가(Execution Plan Evaluation)
- 각 실행 계획의 비용 계산
  - I/O 비용: 디스크 읽기/쓰기 작업 비용
  - CPU 비용: 연산 처리 비용
  - 메모리 사용량: 정렬, 해시 조인 등에 필요한 메모리
  - 네트워크 비용: 분산 데이터베이스 환경에서의 통신 비용
- 통계 정보 활용
  - 테이블의 행 수
  - 컬럼의 분포도
  - 인덱스의 선택도
  - 데이터 블록 수
- 비용 기반 최적화(Cost-Based Optimization) 수행
- 최적의 실행 계획 선택

### 4. 실행 계획 실행(Execution Plan Execution)
- 선택된 실행 계획에 따라 쿼리 실행
- 실행 중 모니터링 및 동적 최적화
- 결과 집합 생성 및 반환

## 옵티마이저의 최적화 기법

### 1. 규칙 기반 최적화(Rule-Based Optimization)
- 미리 정의된 우선순위 규칙에 따라 실행 계획 선택
- 통계 정보에 의존하지 않음
- 단순하고 예측 가능한 실행 계획 생성

### 2. 비용 기반 최적화(Cost-Based Optimization)
- 통계 정보를 기반으로 각 실행 계획의 비용 계산
- 가장 낮은 비용의 실행 계획 선택
- 더 정확하고 효율적인 실행 계획 생성 가능

### 3. 힌트(Hint) 사용
- 개발자가 옵티마이저에게 특정 실행 계획을 강제하는 방법
- 특수한 상황에서 성능 최적화에 활용
- 잘못된 사용은 오히려 성능 저하를 야기할 수 있음

## 옵티마이저 성능 향상 방법

### 1. 통계 정보 관리
- 정기적인 통계 정보 갱신
- 샘플링 크기 조정
- 히스토그램 생성

### 2. 인덱스 설계
- 적절한 인덱스 생성
- 복합 인덱스 설계
- 인덱스 선택도 고려

### 3. 쿼리 튜닝
- 효율적인 SQL 작성
- 적절한 조인 방법 선택
- 서브쿼리 최적화

### 4. 데이터베이스 파라미터 설정
- 메모리 크기 조정
- 병렬 처리 설정
- 버퍼 캐시 크기 조정

## 옵티마이저의 한계와 고려사항

### 1. 통계 정보의 정확성
- 오래된 통계 정보는 잘못된 실행 계획을 유발
- 데이터 분포의 급격한 변화는 성능 저하의 원인

### 2. 실행 계획의 복잡성
- 복잡한 쿼리는 많은 실행 계획 후보를 생성
- 최적의 실행 계획을 찾는 데 많은 시간 소요

### 3. 하드웨어 제약
- 메모리, CPU, I/O 자원의 제한
- 분산 환경에서의 네트워크 지연

### 4. 동시성 제어
- 여러 사용자의 동시 접근
- 락(Lock)과 블로킹(Blocking) 관리

## 결론
옵티마이저는 데이터베이스 성능의 핵심 요소로, 효율적인 실행 계획을 생성하여 쿼리 성능을 최적화하는 역할을 수행합니다. 이를 위해서는 정확한 통계 정보, 적절한 인덱스 설계, 효율적인 SQL 작성이 필요하며, 지속적인 모니터링과 튜닝이 요구됩니다.

```
[출처]
1. DB Optimizer(옵티마이저)|작성자 Sodam
2. Oracle Database Performance Tuning Guide
3. SQL Server Query Performance Tuning
```
