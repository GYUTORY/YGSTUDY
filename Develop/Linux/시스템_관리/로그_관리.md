---
title: 로그 관리
tags: [linux, log, journalctl, syslog, logrotate]
updated: 2025-12-08
---

# 로그 관리

## 개요

시스템과 애플리케이션의 로그 확인 및 관리 방법. 문제 진단과 모니터링에 필수다.

## 주요 로그 파일 위치

### 시스템 로그

```bash
/var/log/messages               # 일반 시스템 메시지 (RHEL/CentOS)
/var/log/syslog                 # 시스템 로그 (Debian/Ubuntu)
/var/log/auth.log               # 인증 로그
/var/log/secure                 # 보안 로그 (RHEL/CentOS)
/var/log/kern.log               # 커널 로그
/var/log/boot.log               # 부팅 로그
```

### 서비스 로그

```bash
/var/log/nginx/
/var/log/apache2/
/var/log/mysql/
/var/log/postgresql/
```

### 애플리케이션 로그

```bash
/var/log/app/
/opt/app/logs/
```

애플리케이션 로그 위치는 설정에 따라 다르다. 설정 파일을 확인한다.

## journalctl (systemd)

systemd 기반 시스템의 로그를 확인한다.

### 기본 사용

```bash
journalctl
journalctl -n 50
journalctl -f                     # 실시간 모니터링
journalctl --since today
journalctl --since "1 hour ago"
journalctl --since "2025-01-01 10:00:00"
journalctl --until "2025-01-01 12:00:00"
```

### 서비스별 로그

```bash
journalctl -u nginx
journalctl -u nginx -f
journalctl -u nginx --since today
```

### 우선순위별 필터링

```bash
journalctl -p err                 # 에러만
journalctl -p warning
journalctl -p info
```

**우선순위:**
- 0: emerg (긴급)
- 1: alert (경보)
- 2: crit (치명적)
- 3: err (에러)
- 4: warning (경고)
- 5: notice (알림)
- 6: info (정보)
- 7: debug (디버그)

### 로그 검색

```bash
journalctl -g "error"
journalctl _PID=1234
journalctl _UID=1000
journalctl _COMM=nginx
```

### 로그 저장

```bash
journalctl -o json
journalctl -o json-pretty
journalctl > log.txt
```

`journalctl -xe`는 최근 에러와 상세 정보를 보여준다. 문제 진단에 유용하다.

## 로그 파일 확인

### tail

로그 파일의 마지막 부분을 확인한다.

```bash
tail /var/log/messages
tail -n 100 /var/log/messages
tail -f /var/log/messages         # 실시간 모니터링
tail -F /var/log/messages         # 파일 재생성 시에도 모니터링
```

`tail -f`는 로그를 실시간으로 모니터링한다. 여러 파일을 동시에 모니터링할 수 있다.

### head

로그 파일의 앞부분을 확인한다.

```bash
head /var/log/messages
head -n 100 /var/log/messages
```

### less / more

페이지 단위로 로그를 확인한다.

```bash
less /var/log/messages
more /var/log/messages
```

**less 명령어:**
- `/검색어`: 검색
- `n`: 다음 검색 결과
- `q`: 종료

### grep

로그에서 특정 패턴을 검색한다.

```bash
grep "error" /var/log/messages
grep -i "error" /var/log/messages
grep -v "info" /var/log/messages
grep -A 5 "error" /var/log/messages  # 에러 후 5줄
grep -B 5 "error" /var/log/messages  # 에러 전 5줄
grep -C 5 "error" /var/log/messages  # 에러 전후 5줄
```

## 로그 로테이션

### logrotate

로그 파일을 자동으로 로테이션한다.

### 설정 파일

```bash
# /etc/logrotate.d/myapp
/var/log/myapp/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0644 app app
    postrotate
        systemctl reload myapp
    endscript
}
```

### 수동 실행

```bash
logrotate -d /etc/logrotate.conf  # 테스트 (dry-run)
logrotate -f /etc/logrotate.conf  # 강제 실행
logrotate -v /etc/logrotate.conf  # 상세 출력
```

`-d` 옵션으로 설정을 테스트한다. 실제 로테이션 전에 확인한다.

## 로그 분석

### 특정 시간대 로그

```bash
# journalctl
journalctl --since "2025-01-01 10:00:00" --until "2025-01-01 11:00:00"

# grep
grep "2025-01-01 10:" /var/log/messages
```

### 에러 통계

```bash
# 에러 개수
grep -c "ERROR" /var/log/app.log

# 에러 종류별 개수
grep "ERROR" /var/log/app.log | awk '{print $5}' | sort | uniq -c

# 시간대별 에러
grep "ERROR" /var/log/app.log | awk '{print $1, $2}' | cut -d: -f1 | uniq -c
```

### IP 주소 분석

```bash
# 접근 IP 상위 10개
awk '{print $1}' access.log | sort | uniq -c | sort -rn | head -10

# 특정 IP의 접근
grep "192.168.1.1" access.log
```

### 응답 시간 분석

```bash
# 평균 응답 시간
awk '{sum+=$NF; count++} END {print sum/count}' access.log

# 1초 이상 응답
awk '$NF > 1.0 {print}' access.log
```

## 로그 모니터링

### 실시간 모니터링

```bash
# 단일 파일
tail -f /var/log/app.log

# 여러 파일
tail -f /var/log/app.log /var/log/error.log

# journalctl
journalctl -u nginx -f
```

### 로그 알림

```bash
#!/bin/bash
ERROR_COUNT=$(grep -c "ERROR" /var/log/app.log)

if [ $ERROR_COUNT -gt 100 ]; then
    echo "High error count: $ERROR_COUNT" | mail -s "Alert" admin@example.com
fi
```

모니터링 도구(Prometheus, ELK 등)와 연동하여 자동 알림을 설정한다.

## 로그 정리

### 오래된 로그 삭제

```bash
# 30일 이상 된 로그 삭제
find /var/log -type f -mtime +30 -delete

# 특정 크기 이상 로그 삭제
find /var/log -type f -size +100M -delete
```

### 로그 압축

```bash
# 오래된 로그 압축
find /var/log -type f -mtime +7 -exec gzip {} \;
```

로그는 정기적으로 정리한다. 디스크 공간을 확보한다.

## 로그 보안

### 로그 권한

```bash
# 로그 파일 권한 설정
chmod 640 /var/log/app.log
chown app:adm /var/log/app.log
```

### 로그 무결성

```bash
# 로그 무결성 검증 (AIDE 등 사용)
aide --check
```

로그 파일은 변조되지 않도록 권한을 제한한다.

## 애플리케이션 로그 설정

### 로그 레벨

```bash
# 애플리케이션 설정 예시
LOG_LEVEL=INFO                    # DEBUG, INFO, WARN, ERROR
LOG_FILE=/var/log/app.log
LOG_MAX_SIZE=100M
LOG_BACKUP_COUNT=10
```

### 로그 포맷

```bash
# 표준 로그 포맷
[2025-01-01 10:00:00] [INFO] [module] Message
```

로그 포맷을 표준화하면 분석이 쉬워진다. JSON 형식도 유용하다.

## 일반적인 문제 해결

### 로그가 너무 많을 때

```bash
# 특정 시간대만
grep "2025-01-01 10:" /var/log/app.log

# 에러만
grep "ERROR" /var/log/app.log

# 최근 로그만
tail -n 1000 /var/log/app.log
```

### 로그 파일이 없을 때

```bash
# 로그 디렉토리 확인
ls -la /var/log/

# 서비스 상태 확인
systemctl status service

# 로그 설정 확인
journalctl -u service
```

### 로그가 쌓이지 않을 때

```bash
# 디스크 공간 확인
df -h

# inode 확인
df -i

# 로그 권한 확인
ls -l /var/log/app.log
```

로그 문제는 디스크 공간, 권한, 서비스 상태를 순서대로 확인한다.
