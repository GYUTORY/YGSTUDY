---
title: 시스템 모니터링
tags: [linux, monitoring, sar, iostat, vmstat, free, netstat, ss]
updated: 2025-12-08
---

# 시스템 모니터링

## 개요

시스템 리소스 사용량 모니터링 방법. CPU, 메모리, 디스크, 네트워크 상태를 확인한다.

## CPU 모니터링

### top

실시간 CPU 사용률을 확인한다.

```bash
top
top -p 1234
```

**주요 정보:**
- load average: 시스템 부하
- %CPU: CPU 사용률
- %MEM: 메모리 사용률

### htop

향상된 top.

```bash
htop
```

`top`보다 사용하기 편하다. 설치가 필요할 수 있다.

### uptime

시스템 가동 시간과 부하를 확인한다.

```bash
uptime
```

**load average:**
- 1분, 5분, 15분 평균 부하
- CPU 코어 수를 기준으로 판단
- 코어 수보다 낮으면 정상

load average가 CPU 코어 수보다 높으면 부하가 높은 상태다.

### vmstat

가상 메모리 통계를 확인한다.

```bash
vmstat                       # 한 번 출력
vmstat 1                     # 1초마다 출력
vmstat 1 10                  # 1초마다 10번 출력
```

**주요 필드:**
- r: 실행 대기 중인 프로세스
- b: 블록된 프로세스
- swpd: 사용 중인 스왑
- free: 여유 메모리
- si/so: 스왑 인/아웃
- us/sy/id/wa: CPU 사용률 (user/system/idle/wait)

`wa`(wait)가 높으면 I/O 병목이 있다.

### mpstat

CPU별 통계를 확인한다.

```bash
mpstat
mpstat -P ALL                # 각 CPU 코어별 통계
mpstat 1
```

멀티코어 시스템에서 CPU 부하 분산을 확인할 때 사용한다.

### sar

시스템 활동을 기록하고 보고한다.

```bash
sar                          # 오늘의 통계
sar -u 1 10                  # CPU 사용률, 1초마다 10번
sar -r 1 10                  # 메모리 사용률
sar -d 1 10                  # 디스크 I/O
sar -n DEV 1 10              # 네트워크 통계
sar -f /var/log/sa/sa01     # 특정 날짜 통계
```

**설정:**
```bash
# /etc/cron.d/sysstat
*/10 * * * * root /usr/lib64/sa/sa1 1 1
```

`sar`은 과거 데이터를 확인할 수 있어 문제 분석에 유용하다. `sysstat` 패키지가 필요하다.

## 메모리 모니터링

### free

메모리 사용량을 확인한다.

```bash
free                         # 기본 (KB 단위)
free -h                      # 사람이 읽기 쉬운 형식
free -m                      # MB 단위
free -s 1                    # 1초마다 출력
```

**주요 필드:**
- total: 전체 메모리
- used: 사용 중
- free: 여유
- shared: 공유 메모리
- buff/cache: 버퍼/캐시
- available: 실제 사용 가능한 메모리

`available`이 실제 사용 가능한 메모리다. `free`는 캐시를 포함하지 않는다.

### vmstat

메모리와 스왑 정보를 확인한다.

```bash
vmstat -s                   # 메모리 요약
vmstat 1                    # 실시간 모니터링
```

### /proc/meminfo

상세 메모리 정보를 확인한다.

```bash
cat /proc/meminfo
grep MemTotal /proc/meminfo
```

## 디스크 모니터링

### df

파일시스템 사용량을 확인한다.

```bash
df
df -h
df -i                       # inode 사용량
df -T                       # 파일시스템 타입
```

### du

디렉토리 사용량을 확인한다.

```bash
du -h /var/log
du -sh /var/log/*
du -h --max-depth=1 /var
```

### iostat

디스크 I/O 통계를 확인한다.

```bash
iostat
iostat -x 1                 # 확장 정보, 1초마다
iostat -d sda
iostat -m                   # MB 단위
```

**주요 필드:**
- r/s, w/s: 초당 읽기/쓰기
- rkB/s, wkB/s: 초당 읽기/쓰기 KB
- %util: 디스크 사용률
- await: 평균 대기 시간

`%util`이 100%에 가까우면 디스크 병목이다.

### iotop

프로세스별 디스크 I/O를 확인한다.

```bash
iotop
iotop -o                    # I/O가 있는 프로세스만
iotop -a                    # 누적 통계
```

어떤 프로세스가 디스크를 많이 사용하는지 확인할 때 유용하다.

### sar -d

디스크 I/O 통계를 확인한다.

```bash
sar -d 1 10                 # 디스크 통계, 1초마다 10번
sar -d -p 1 10              # 사람이 읽기 쉬운 형식
```

## 네트워크 모니터링

### ifconfig

네트워크 인터페이스 정보를 확인한다.

```bash
ifconfig
ifconfig eth0
ifconfig eth0 up
ifconfig eth0 down
```

최신 시스템에서는 `ip` 명령어를 사용한다.

### ip

네트워크 인터페이스를 관리한다.

```bash
ip addr show                # IP 주소 확인
ip link show                # 링크 상태 확인
ip route show               # 라우팅 테이블
ip -s link show eth0        # 통계 포함
```

`ifconfig`보다 더 강력하고 최신 명령어다.

### netstat

네트워크 연결 상태를 확인한다.

```bash
netstat -an                 # 모든 연결
netstat -tuln                # TCP/UDP 리스닝 포트
netstat -rn                  # 라우팅 테이블
netstat -i                   # 인터페이스 통계
netstat -s                   # 프로토콜별 통계
```

최신 시스템에서는 `ss` 명령어를 권장한다.

### ss

소켓 통계를 확인한다.

```bash
ss -an                      # 모든 소켓
ss -tuln                     # TCP/UDP 리스닝 포트
ss -tulpn                    # 프로세스 정보 포함
ss -s                        # 요약 통계
ss -o state established      # ESTABLISHED 상태만
```

`netstat`보다 빠르다. 프로세스 정보는 `-p` 옵션으로 확인한다.

### sar -n

네트워크 통계를 확인한다.

```bash
sar -n DEV 1 10             # 네트워크 인터페이스 통계
sar -n EDEV 1 10             # 에러 통계
sar -n TCP 1 10              # TCP 통계
```

### tcpdump

네트워크 패킷을 캡처한다.

```bash
tcpdump -i eth0              # 모든 패킷
tcpdump -i eth0 port 80      # 포트 80만
tcpdump -i eth0 host 192.168.1.1
tcpdump -i eth0 -w file.pcap # 파일로 저장
```

네트워크 문제 진단에 유용하다. root 권한이 필요하다.

### nethogs

프로세스별 네트워크 사용량을 확인한다.

```bash
nethogs
nethogs eth0
```

어떤 프로세스가 네트워크를 많이 사용하는지 확인할 때 유용하다.

## 종합 모니터링

### glances

종합 시스템 모니터링 도구.

```bash
glances
glances -s                   # 서버 모드
glances -c server-ip         # 클라이언트 모드
```

**특징:**
- CPU, 메모리, 디스크, 네트워크 통합 모니터링
- 웹 인터페이스 지원
- 플러그인 지원

설치가 필요하다. 한눈에 시스템 상태를 파악할 수 있다.

### dstat

다양한 시스템 리소스를 모니터링한다.

```bash
dstat
dstat -cdngy                # CPU, 디스크, 네트워크, 페이지, 시스템
dstat -t -cdngy             # 타임스탬프 포함
```

설치가 필요하다. 여러 리소스를 동시에 모니터링할 때 유용하다.

## 로그 기반 모니터링

### sar 데이터 확인

```bash
sar -u -f /var/log/sa/sa01  # 특정 날짜 CPU 통계
sar -r -f /var/log/sa/sa01  # 메모리 통계
sar -d -f /var/log/sa/sa01  # 디스크 통계
```

과거 성능 데이터를 분석할 때 사용한다.

## 모니터링 스크립트 예시

### 간단한 모니터링 스크립트

```bash
#!/bin/bash
echo "=== CPU ==="
top -bn1 | grep "Cpu(s)"
echo ""
echo "=== Memory ==="
free -h
echo ""
echo "=== Disk ==="
df -h
echo ""
echo "=== Network ==="
ss -s
```

정기적으로 실행하여 시스템 상태를 확인한다.

## 알림 설정

### 임계값 모니터링

```bash
#!/bin/bash
CPU=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
if (( $(echo "$CPU > 80" | bc -l) )); then
    echo "High CPU usage: $CPU%"
    # 알림 전송
fi
```

모니터링 도구(Prometheus, Nagios 등)와 연동하여 자동 알림을 설정한다.
