---
title: 시스템 서비스 관리
tags: [linux, systemd, service, systemctl, init]
updated: 2025-12-08
---

# 시스템 서비스 관리

## 개요

시스템 서비스 시작, 중지, 관리 방법. systemd가 대부분의 최신 배포판에서 사용된다.

## systemd 개요

시스템과 서비스를 관리하는 init 시스템.

**주요 기능:**
- 서비스 관리
- 시스템 부팅 관리
- 로그 관리 (journald)
- 장치 관리
- 타이머 및 작업 스케줄링

대부분의 최신 Linux 배포판(RHEL 7+, Ubuntu 15.04+, Debian 8+)에서 사용한다.

## systemctl 기본 명령어

### 서비스 상태 확인

```bash
systemctl status nginx
systemctl is-active nginx
systemctl is-enabled nginx
systemctl list-units --type=service
systemctl list-unit-files
```

`systemctl status`는 서비스 상태와 최근 로그를 함께 보여준다.

### 서비스 시작/중지/재시작

```bash
systemctl start nginx
systemctl stop nginx
systemctl restart nginx
systemctl reload nginx               # 설정 재로드 (중단 없음)
systemctl reload-or-restart nginx
```

`reload`는 서비스를 중단하지 않고 설정만 다시 읽는다. 가능하면 `reload`를 사용한다.

### 서비스 활성화/비활성화

```bash
systemctl enable nginx               # 부팅 시 자동 시작
systemctl disable nginx
systemctl enable --now nginx         # 활성화하고 즉시 시작
systemctl is-enabled nginx
```

`enable`은 부팅 시 자동 시작만 설정한다. 즉시 시작하려면 `start`도 실행한다.

### 서비스 마스킹

```bash
systemctl mask nginx                 # 서비스 완전 비활성화
systemctl unmask nginx
```

`mask`는 서비스를 완전히 비활성화한다. 실수로 시작되는 것을 방지한다.

## 서비스 파일 위치

### 시스템 서비스

```bash
/etc/systemd/system/                # 시스템 서비스 파일
/usr/lib/systemd/system/            # 패키지 설치 서비스 파일
```

커스텀 서비스는 `/etc/systemd/system/`에 만든다.

### 서비스 파일 예시

```ini
# /etc/systemd/system/myapp.service
[Unit]
Description=My Application
After=network.target

[Service]
Type=simple
User=appuser
WorkingDirectory=/opt/myapp
ExecStart=/opt/myapp/bin/start.sh
ExecStop=/opt/myapp/bin/stop.sh
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**주요 섹션:**
- `[Unit]`: 서비스 설명과 의존성
- `[Service]`: 실행 설정
- `[Install]`: 설치 설정

## 서비스 파일 작성

### Service Type

```ini
Type=simple              # 기본 (ExecStart가 메인 프로세스)
Type=forking             # 백그라운드로 실행
Type=oneshot             # 한 번 실행 후 종료
Type=notify              # systemd에 준비 완료 알림
```

대부분의 경우 `Type=simple`을 사용한다. 데몬은 `Type=forking`을 사용한다.

### 자동 재시작

```ini
Restart=always          # 항상 재시작
Restart=on-failure     # 실패 시만 재시작
Restart=no             # 재시작 안 함
RestartSec=10          # 재시작 전 대기 시간 (초)
```

프로덕션 환경에서는 `Restart=always`를 사용하여 서비스가 항상 실행되도록 한다.

### 환경 변수

```ini
Environment="NODE_ENV=production"
Environment="PORT=3000"
EnvironmentFile=/etc/myapp/env.conf
```

민감한 정보는 `EnvironmentFile`로 관리한다. 파일 권한을 제한한다.

### 리소스 제한

```ini
LimitNOFILE=65536      # 열 수 있는 파일 수
LimitNPROC=4096         # 프로세스 수
MemoryLimit=512M        # 메모리 제한
```

리소스 제한을 설정하면 서비스가 시스템을 과도하게 사용하는 것을 방지한다.

## systemd 변경사항 적용

```bash
systemctl daemon-reload              # 설정 파일 변경 후 필수
systemctl daemon-reexec
```

서비스 파일을 수정한 후 반드시 `daemon-reload`를 실행한다.

## 서비스 로그 확인

### journalctl

systemd의 로그를 확인한다.

```bash
journalctl -u nginx
journalctl -u nginx -f               # 실시간 로그
journalctl -u nginx -n 100
journalctl -u nginx --since today
journalctl -u nginx --since "1 hour ago"
journalctl -u nginx -p err
journalctl -xe                        # 최근 에러와 상세 정보
```

`journalctl -u service -f`는 `tail -f`처럼 실시간 로그를 보여준다.

## 의존성 관리

### 서비스 의존성 확인

```bash
systemctl list-dependencies nginx
systemctl list-dependencies nginx --reverse
```

### 서비스 의존성 설정

```ini
[Unit]
After=network.target mysql.service   # 시작 순서
Requires=mysql.service               # 필수 의존성
Wants=redis.service                  # 선택적 의존성
```

`Requires`는 의존 서비스가 실패하면 자신도 실패한다. `Wants`는 선택적이다.

## 타임머

### systemd 타이머 생성

```ini
# /etc/systemd/system/backup.timer
[Unit]
Description=Daily Backup

[Timer]
OnCalendar=daily
OnCalendar=Mon..Fri 02:00

[Install]
WantedBy=timers.target
```

```bash
systemctl enable backup.timer
systemctl start backup.timer
systemctl list-timers
```

cron 대신 systemd 타이머를 사용할 수 있다. 더 정확한 스케줄링이 가능하다.

## 기타 systemd 명령어

### 시스템 상태

```bash
systemctl status
systemctl list-failed
systemctl --failed
```

### 부팅 관련

```bash
systemctl reboot
systemctl poweroff
systemctl halt
systemctl suspend
```

### 유닛 파일 검증

```bash
systemd-analyze verify myapp.service
systemd-analyze verify /etc/systemd/system/*.service
```

서비스 파일을 작성한 후 검증하는 것이 좋다.

## 전통적인 service 명령어

일부 시스템에서는 여전히 사용된다.

```bash
service nginx start
service nginx stop
service nginx restart
service nginx status
service --status-all
```

`service` 명령어는 systemd의 래퍼다. 내부적으로 `systemctl`을 호출한다.

## chkconfig (RHEL/CentOS 6)

구버전에서 사용하던 명령어.

```bash
chkconfig nginx on
chkconfig nginx off
chkconfig --list
```

RHEL/CentOS 7+에서는 systemd를 사용한다.

## 일반적인 문제 해결

### 서비스가 시작되지 않을 때

```bash
# 1. 상태 확인
systemctl status service

# 2. 로그 확인
journalctl -u service -n 50

# 3. 설정 파일 확인
systemd-analyze verify service.service

# 4. 수동 실행 테스트
/usr/bin/service-command
```

### 서비스가 자동 시작되지 않을 때

```bash
systemctl is-enabled service
systemctl enable service
systemctl daemon-reload
```

### 서비스 파일 수정 후 적용 안 될 때

```bash
systemctl daemon-reload              # 필수
systemctl restart service
```

서비스 파일을 수정한 후 `daemon-reload`를 잊지 않는다.
