---
title: 시스템 성능 튜닝
tags: [linux, performance, tuning, sysctl, ulimit, optimization]
updated: 2025-12-08
---

# 시스템 성능 튜닝

## 개요

시스템 성능 최적화 방법. 모니터링 데이터를 기반으로 한다. 문제를 확인한 후 튜닝한다.

## 커널 파라미터 튜닝

### sysctl

커널 파라미터를 확인하고 설정한다.

```bash
sysctl -a
sysctl kernel.hostname
sysctl -w kernel.hostname=newhost
sysctl -p                        # /etc/sysctl.conf 적용
```

### /etc/sysctl.conf

영구적인 커널 파라미터 설정.

```bash
# /etc/sysctl.conf
# 네트워크 튜닝
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216

# TCP 튜닝
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 300
net.ipv4.tcp_max_syn_backlog = 8192

# 메모리 튜닝
vm.swappiness = 10
vm.dirty_ratio = 15
vm.dirty_background_ratio = 5
```

**적용:**
```bash
sysctl -p
```

## 네트워크 튜닝

### TCP 튜닝

```bash
# /etc/sysctl.conf
# TCP 버퍼 크기
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216

# TCP 연결 관리
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 300
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_tw_recycle = 0      # 최신 커널에서 제거됨

# 포트 범위
net.ipv4.ip_local_port_range = 10000 65535
```

고성능 네트워크 서버에서는 TCP 버퍼를 크게 설정한다.

### 네트워크 인터페이스 튜닝

```bash
ethtool -G eth0 rx 4096 tx 4096  # 링 버퍼 크기
ethtool -K eth0 gro off          # GRO 비활성화
ethtool -K eth0 tso off          # TSO 비활성화
```

## 메모리 튜닝

### 스왑 관리

```bash
# /etc/sysctl.conf
vm.swappiness = 10               # 스왑 사용 비율 (0-100)
```

**swappiness:**
- 0: 스왑 사용 안 함 (메모리 부족 시 OOM)
- 10: 낮은 스왑 사용 (권장)
- 60: 기본값
- 100: 적극적 스왑 사용

서버에서는 `swappiness=10`을 권장한다. 스왑은 느리므로 최소화한다.

### 더티 페이지 관리

```bash
# /etc/sysctl.conf
vm.dirty_ratio = 15              # 전체 메모리의 15%가 더티 페이지면 쓰기
vm.dirty_background_ratio = 5    # 백그라운드 쓰기 시작 비율
vm.dirty_expire_centisecs = 3000 # 더티 페이지 만료 시간
```

쓰기 성능이 중요하면 `dirty_ratio`를 높이고, 데이터 무결성이 중요하면 낮춘다.

## 파일시스템 튜닝

### ext4 튜닝

```bash
# /etc/fstab
/dev/sdb1 /data ext4 defaults,noatime,nodiratime 0 2
```

**마운트 옵션:**
- `noatime`: 접근 시간 업데이트 안 함 (성능 향상)
- `nodiratime`: 디렉토리 접근 시간 업데이트 안 함
- `data=writeback`: 저널링 모드 (성능 향상, 약간의 위험)

### xfs 튜닝

```bash
mount -o noatime,nodiratime /dev/sdb1 /data
```

## 프로세스 제한

### ulimit

프로세스별 리소스 제한을 설정한다.

```bash
ulimit -a
ulimit -n 4096                   # 열 수 있는 파일 수
ulimit -u 1024                   # 프로세스 수
ulimit -s 8192                   # 스택 크기
```

### /etc/security/limits.conf

시스템 전체 리소스 제한.

```bash
# /etc/security/limits.conf
* soft nofile 4096              # 소프트 제한
* hard nofile 8192              # 하드 제한
appuser soft nproc 2048         # 특정 사용자
appuser hard nproc 4096
```

**제한 유형:**
- `nofile`: 열 수 있는 파일 수
- `nproc`: 프로세스 수
- `memlock`: 메모리 잠금
- `fsize`: 파일 크기

애플리케이션별로 적절한 제한을 설정한다. 너무 낮으면 오류가 발생한다.

## I/O 스케줄러

### I/O 스케줄러 확인

```bash
cat /sys/block/sda/queue/scheduler
# noop deadline [cfq]
```

### I/O 스케줄러 변경

```bash
# 임시 변경
echo deadline > /sys/block/sda/queue/scheduler

# 영구 변경
# /etc/rc.local 또는 systemd 서비스
echo deadline > /sys/block/sda/queue/scheduler
```

**스케줄러 종류:**
- `noop`: 단순 FIFO (SSD에 적합)
- `deadline`: 데드라인 기반 (일반 디스크)
- `cfq`: 완전 공정 큐잉 (기본값)

SSD는 `noop` 또는 `deadline`, 일반 디스크는 `deadline`을 사용한다.

## CPU 튜닝

### CPU 주파수 조정

```bash
# CPU 주파수 확인
cpupower frequency-info

# 성능 모드
cpupower frequency-set -g performance

# 절전 모드
cpupower frequency-set -g powersave
```

서버에서는 성능 모드를 사용한다. 전력 소비는 증가한다.

### CPU 어피니티

```bash
# 프로세스를 특정 CPU에 할당
taskset -c 0,1 command           # CPU 0, 1에 할당
taskset -p 0x3 1234              # PID 1234를 CPU 0, 1에 할당
```

## 모니터링 기반 튜닝

### 성능 측정

```bash
# CPU 모니터링
top
htop
sar -u 1 10

# 메모리 모니터링
free -h
sar -r 1 10

# 디스크 I/O 모니터링
iostat -x 1 10
sar -d 1 10

# 네트워크 모니터링
sar -n DEV 1 10
```

### 병목 지점 확인

```bash
# CPU 병목
top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1

# 메모리 병목
free | grep Mem | awk '{print ($3/$2) * 100.0}'

# 디스크 I/O 병목
iostat -x 1 | grep sda | awk '{print $10}'
```

튜닝 전에 병목 지점을 정확히 파악한다. 잘못된 튜닝은 오히려 성능을 저하시킬 수 있다.

## 애플리케이션별 튜닝

### 웹 서버 (Nginx)

```bash
# /etc/nginx/nginx.conf
worker_processes auto;
worker_connections 1024;
keepalive_timeout 65;
```

### 데이터베이스 (MySQL)

```bash
# /etc/my.cnf
innodb_buffer_pool_size = 4G
innodb_log_file_size = 512M
max_connections = 500
```

### Java 애플리케이션

```bash
# JVM 옵션
-Xms2g -Xmx2g                    # 힙 메모리
-XX:+UseG1GC                     # G1 가비지 컬렉터
```

## 튜닝 주의사항

### 점진적 튜닝

한 번에 모든 파라미터를 변경하지 않는다. 하나씩 변경하고 효과를 확인한다.

### 백업

튜닝 전에 설정 파일을 백업한다.

```bash
cp /etc/sysctl.conf /etc/sysctl.conf.bak
```

### 테스트

프로덕션 환경에 적용하기 전에 테스트 환경에서 검증한다.

### 문서화

튜닝 내용과 효과를 문서화한다.

튜닝은 신중하게 진행한다. 잘못된 설정은 시스템 불안정을 초래할 수 있다.
