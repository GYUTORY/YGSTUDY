---
title: 파일 시스템
tags: [linux, filesystem, ext4, xfs, mount, df, du]
updated: 2025-12-08
---

# 파일 시스템

## 개요

파일과 디렉토리를 저장하고 관리하는 방식. 파일시스템 타입에 따라 성능과 기능이 다르다.

## 주요 파일시스템 타입

### ext4

가장 널리 사용되는 Linux 파일시스템.

**특징:**
- 저널링 지원
- 최대 파일 크기: 16TB
- 최대 파일시스템 크기: 1EB
- 안정성과 호환성 우수

대부분의 Linux 배포판의 기본 파일시스템이다.

### xfs

대용량 파일과 고성능이 필요한 경우에 사용.

**특징:**
- 매우 큰 파일시스템 지원 (최대 16EB)
- 고성능 I/O
- 온라인 확장 가능
- 저널링 지원

대용량 스토리지나 데이터베이스 서버에 적합하다. Red Hat 계열에서 기본으로 사용한다.

### btrfs

고급 기능을 제공하는 최신 파일시스템.

**특징:**
- 스냅샷 지원
- 압축 기능
- RAID 기능 내장
- 온라인 확장/축소

스냅샷이 필요한 환경에 유용하다. 아직 안정성 문제가 있을 수 있어 프로덕션 사용 시 주의한다.

### tmpfs

메모리에 저장하는 임시 파일시스템.

**특징:**
- 매우 빠른 속도
- 재부팅 시 데이터 손실
- 메모리 사용

`/tmp`나 `/dev/shm`에 사용된다. 임시 파일 저장에 적합하다.

## 디스크 사용량 확인

### df

파일시스템의 사용 가능한 공간을 확인한다.

```bash
df                          # 기본 정보
df -h                       # 사람이 읽기 쉬운 형식
df -T                       # 파일시스템 타입 포함
df -i                       # inode 사용량
df -h /var
```

`df -h`는 가장 자주 사용한다.

### du

디렉토리나 파일의 디스크 사용량을 확인한다.

```bash
du                          # 현재 디렉토리
du -h                       # 사람이 읽기 쉬운 형식
du -s                       # 요약만
du -sh /var/log
du -h --max-depth=1 /var
du -h | sort -h
```

`du -sh *`는 현재 디렉토리의 각 항목 크기를 보여준다.

## 파일시스템 마운트

### mount

파일시스템을 마운트한다.

```bash
mount /dev/sdb1 /mnt
mount -t ext4 /dev/sdb1 /mnt
mount -o ro /dev/sdb1 /mnt
mount -o noexec /dev/sdb1 /mnt
mount                        # 현재 마운트된 파일시스템 확인
```

### umount

파일시스템을 언마운트한다.

```bash
umount /mnt
umount -l /mnt              # 지연 언마운트
umount -f /mnt              # 강제 언마운트
```

사용 중인 파일시스템은 언마운트할 수 없다. `lsof /mnt`로 사용 중인 프로세스를 확인한다.

### /etc/fstab

부팅 시 자동으로 마운트할 파일시스템을 설정한다.

```bash
# /etc/fstab
/dev/sda1  /          ext4    defaults        1 1
/dev/sda2  /home      ext4    defaults        1 2
/dev/sdb1  /backup    ext4    defaults,noexec 1 2
```

**필드:**
1. 장치명 또는 UUID
2. 마운트 포인트
3. 파일시스템 타입
4. 마운트 옵션
5. dump 백업 (0 또는 1)
6. 파일시스템 체크 순서 (0=체크 안함)

UUID를 사용하면 장치명이 바뀌어도 안정적이다. `blkid`로 UUID를 확인할 수 있다.

## 파일시스템 생성

### mkfs

새로운 파일시스템을 생성한다. 모든 데이터를 삭제한다.

```bash
mkfs.ext4 /dev/sdb1         # ext4 파일시스템 생성
mkfs.xfs /dev/sdb1          # xfs 파일시스템 생성
mkfs -t ext4 /dev/sdb1
mkfs.ext4 -L DATA /dev/sdb1 # 레이블 지정
```

### mke2fs

ext2/ext3/ext4 파일시스템을 생성한다.

```bash
mke2fs -t ext4 /dev/sdb1
mke2fs -j /dev/sdb1         # ext3 생성 (저널링)
mke2fs -L MYDISK /dev/sdb1
```

## 파일시스템 점검 및 수리

### fsck

파일시스템을 점검하고 수리한다.

```bash
umount /dev/sdb1            # 언마운트
fsck /dev/sdb1              # 파일시스템 점검
fsck -y /dev/sdb1           # 자동으로 수리
fsck -f /dev/sdb1           # 강제 점검
fsck.ext4 /dev/sdb1
mount /dev/sdb1 /mnt        # 재마운트
```

언마운트된 상태에서 점검한다. 루트 파일시스템은 부팅 시 자동으로 점검된다.

### e2fsck

ext2/ext3/ext4 파일시스템을 점검한다.

```bash
e2fsck /dev/sdb1
e2fsck -p /dev/sdb1         # 자동 수리
e2fsck -f /dev/sdb1
```

## 파일시스템 정보 확인

### blkid

블록 장치의 파일시스템 정보를 확인한다.

```bash
blkid                       # 모든 블록 장치 정보
blkid /dev/sda1
```

UUID 확인에 유용하다.

### lsblk

블록 장치를 트리 형태로 보여준다.

```bash
lsblk                       # 기본 정보
lsblk -f                    # 파일시스템 정보 포함
lsblk -o NAME,SIZE,TYPE,MOUNTPOINT
```

디스크 구조를 한눈에 파악할 때 유용하다.

### file -s

블록 장치의 파일시스템 타입을 확인한다.

```bash
file -s /dev/sda1
```

## inode

파일시스템의 파일과 디렉토리를 식별하는 고유 번호.

```bash
ls -i file.txt              # 파일의 inode 번호
stat file.txt               # 상세 inode 정보
df -i                       # inode 사용량
```

작은 파일이 많으면 inode가 부족할 수 있다. `df -i`로 확인한다.

## 디스크 I/O 모니터링

### iostat

디스크 I/O 통계를 확인한다.

```bash
iostat                      # 기본 정보
iostat -x 1                 # 확장 정보, 1초마다
iostat -d sda
```

`sysstat` 패키지가 필요하다.

### iotop

프로세스별 디스크 I/O를 확인한다.

```bash
iotop                       # 실시간 모니터링
iotop -o                    # I/O가 있는 프로세스만
```

어떤 프로세스가 디스크를 많이 사용하는지 확인할 때 유용하다.

## 파일시스템 최적화

### tune2fs

ext2/ext3/ext4 파일시스템 파라미터를 조정한다.

```bash
tune2fs -l /dev/sda1        # 파일시스템 정보 확인
tune2fs -L NEWLABEL /dev/sda1
tune2fs -m 5 /dev/sda1      # 예약 공간 5%로 설정
```

예약 공간은 root 전용이다. 일반적으로 5%면 충분하다.

### xfs_admin

xfs 파일시스템을 관리한다.

```bash
xfs_admin -l /dev/sda1
xfs_admin -L NEWLABEL /dev/sda1
```

## 일반적인 문제 해결

### 디스크 공간 부족

```bash
du -h / | sort -h | tail -20
find /var/log -type f -mtime +30 -delete
rm -rf /tmp/*
```

### 파일시스템 읽기 전용

```bash
fsck /dev/sda1
mount -o remount,rw /
```

### inode 부족

```bash
df -i
find /path -type f -size -1k -delete
```

디스크 공간은 충분한데 "No space left" 에러가 나면 inode 부족일 수 있다.
