---
title: 파일 권한 및 소유권
tags: [linux, permission, ownership, chmod, chown, security]
updated: 2025-12-08
---

# 파일 권한 및 소유권

## 개요

Linux는 다중 사용자 시스템이다. 파일과 디렉토리에 대한 접근 권한을 세밀하게 제어할 수 있다. 권한 설정은 보안에 직접 영향을 준다. 최소 권한 원칙을 따른다.

## 파일 권한 이해

### 권한의 구성

파일 권한은 3가지로 구성된다:
- 소유자(Owner): 파일을 만든 사용자
- 그룹(Group): 파일이 속한 그룹
- 기타(Others): 나머지 모든 사용자

각각에 대해 3가지 권한이 있다:
- 읽기(Read, r): 파일 읽기, 디렉토리 목록 보기
- 쓰기(Write, w): 파일 수정, 디렉토리 내 파일 생성/삭제
- 실행(Execute, x): 파일 실행, 디렉토리 접근

**디렉토리 권한:**
- 읽기(r): 디렉토리 내용 목록 보기 (`ls`)
- 쓰기(w): 디렉토리 내 파일 생성/삭제
- 실행(x): 디렉토리 접근 (`cd`)

디렉토리에서 실행 권한이 없으면 접근할 수 없다.

### 권한 표기법

#### 문자 표기법

```bash
-rw-r--r-- 1 user group 1024 Jan 1 10:00 file.txt
drwxr-xr-x 2 user group 4096 Jan 1 10:00 dir1
lrwxrwxrwx 1 user group   10 Jan 1 10:00 link -> target
```

- 첫 번째 문자: `-`는 파일, `d`는 디렉토리, `l`은 심볼릭 링크
- 2-4번째: 소유자 권한 (rw-)
- 5-7번째: 그룹 권한 (r--)
- 8-10번째: 기타 권한 (r--)

#### 숫자 표기법

```bash
r = 4 (읽기)
w = 2 (쓰기)
x = 1 (실행)
```

**예시:**
- `755`: rwxr-xr-x (소유자: 모든 권한, 그룹/기타: 읽기+실행)
- `644`: rw-r--r-- (소유자: 읽기+쓰기, 그룹/기타: 읽기)
- `600`: rw------- (소유자만 읽기+쓰기)
- `777`: rwxrwxrwx (모든 사용자 모든 권한, 위험)

일반 파일은 `644`, 실행 파일은 `755`, 비밀 파일은 `600`을 사용한다. `777`은 보안상 위험하다.

## chmod

파일이나 디렉토리의 권한을 변경한다.

### 숫자 모드

```bash
chmod 755 script.sh        # rwxr-xr-x
chmod 644 file.txt
chmod 600 secret.txt
chmod 750 script.sh        # rwxr-x---
```

**일반적인 권한:**
- `755`: 실행 파일, 디렉토리
- `644`: 일반 파일
- `600`: 비밀 파일
- `750`: 그룹 실행 가능한 스크립트
- `640`: 그룹 읽기 가능한 파일

`777`은 모든 사용자가 모든 권한을 가진다. 보안상 위험하므로 사용을 피한다.

### 문자 모드

```bash
chmod u+x script.sh        # 소유자에 실행 권한 추가
chmod g-w file.txt         # 그룹에서 쓰기 권한 제거
chmod o+r file.txt
chmod a+x script.sh
chmod u=rwx,g=rx,o=r file.txt
chmod +x script.sh         # a 생략 가능
chmod -x script.sh
```

**옵션:**
- `u`: 소유자
- `g`: 그룹
- `o`: 기타
- `a`: 모든 사용자 (생략 가능)
- `+`: 권한 추가
- `-`: 권한 제거
- `=`: 권한 설정

문자 모드는 기존 권한에 추가하거나 제거할 때 유용하다.

### 재귀적 권한 변경

```bash
chmod -R 755 /var/www
chmod -R u+x scripts/
chmod -R g+w /shared/
```

주의: `chmod -R 777 /` 같은 명령은 절대 사용하지 않는다.

`-R` 옵션은 하위 디렉토리까지 모두 변경한다. 경로를 확인한 후 실행한다.

## chown

파일이나 디렉토리의 소유자를 변경한다.

```bash
chown user file.txt
chown user:group file.txt
chown :group file.txt              # 그룹만 변경
chown -R user:group /var/www
chown --reference=ref.txt file.txt
```

일반 사용자는 자신의 파일 소유자만 변경할 수 있다. root 권한이 필요하다. 웹 서버 파일은 보통 `www-data`나 `apache` 사용자로 설정한다.

## chgrp

파일이나 디렉토리의 그룹을 변경한다.

```bash
chgrp developers file.txt
chgrp -R developers /var/www
chgrp --reference=ref.txt file.txt
```

`chown :group`과 동일하다.

## 특수 권한

### SetUID

실행 시 파일 소유자의 권한으로 실행된다.

```bash
chmod u+s /usr/bin/passwd
chmod 4755 script.sh
ls -l /usr/bin/passwd
# -rwsr-xr-x 1 root root ... /usr/bin/passwd
```

일반 사용자가 실행해도 소유자 권한으로 실행된다. `passwd` 명령어가 root 권한으로 `/etc/shadow`를 수정하는 이유다. 보안상 주의가 필요하다. SetUID 파일은 최소화한다.

### SetGID

실행 시 파일 그룹의 권한으로 실행되거나, 디렉토리에 생성된 파일이 그룹을 상속받는다.

```bash
chmod g+s script.sh
chmod 2755 dir1
chmod g+s /shared/
```

디렉토리에 SetGID를 설정하면 새로 생성된 파일이 디렉토리 그룹을 상속받는다. 공유 디렉토리에서 유용하다.

### Sticky Bit

디렉토리에 설정하면, 파일은 소유자만 삭제할 수 있다.

```bash
chmod +t /tmp
chmod 1777 /tmp
ls -ld /tmp
# drwxrwxrwt ... /tmp
```

모든 사용자가 파일 생성 가능하지만, 자신이 만든 파일만 삭제 가능하다. `/tmp` 디렉토리가 이 권한을 사용한다.

## umask

새로 생성되는 파일의 기본 권한을 설정한다.

```bash
umask                              # 현재 umask 확인
umask 022                          # umask 설정
umask 002                          # 그룹 쓰기 허용
umask -S                           # 심볼릭 형식으로 표시
```

**umask 계산:**
- 기본 권한: 파일 666, 디렉토리 777
- 실제 권한 = 기본 권한 - umask

**예시:**
- umask 022: 파일 644, 디렉토리 755
- umask 002: 파일 664, 디렉토리 775
- umask 077: 파일 600, 디렉토리 700

**영구 설정:**
```bash
# ~/.bashrc 또는 ~/.bash_profile
umask 022
```

서버에서는 보통 `022`를 사용한다.

## 권한 확인

### ls -l

```bash
ls -l file.txt
ls -ld dir1
```

### stat

```bash
stat file.txt
stat -c "%a %n" file.txt   # 권한과 파일명만
stat -c "%U %G" file.txt   # 소유자와 그룹만
```

### getfacl

```bash
getfacl file.txt
getfacl -R dir1/
```

## ACL

기본 권한보다 세밀한 제어가 필요할 때 사용한다.

### setfacl

```bash
setfacl -m u:john:rw file.txt      # john에게 읽기/쓰기 권한
setfacl -m g:developers:r file.txt
setfacl -x u:john file.txt         # john의 ACL 제거
setfacl -b file.txt                # 모든 ACL 제거
setfacl -R -m u:john:rw dir1/
setfacl -m d:u:john:rw dir1/       # 기본 ACL 설정
setfacl -k dir1/                    # 기본 ACL 제거
```

**ACL 확인:**
```bash
getfacl file.txt
```

특정 사용자에게만 권한을 주고 싶을 때 유용하다. 파일시스템이 ACL을 지원해야 한다. ext4는 `acl` 마운트 옵션이 필요하다.

**ACL 활성화:**
```bash
mount -o acl /dev/sdb1 /mnt
# /etc/fstab
/dev/sdb1 /mnt ext4 defaults,acl 0 2
```

## 일반적인 권한 설정

### 웹 서버 파일

```bash
# 정적 파일
chmod 644 /var/www/html/index.html
chown www-data:www-data /var/www/html/index.html

# 실행 스크립트
chmod 755 /var/www/cgi-bin/script.cgi
chown www-data:www-data /var/www/cgi-bin/script.cgi

# 디렉토리
chmod 755 /var/www/html
chown -R www-data:www-data /var/www/html

# 업로드 디렉토리
chmod 775 /var/www/uploads
chown www-data:www-data /var/www/uploads
chmod g+s /var/www/uploads
```

### 로그 파일

```bash
chmod 640 /var/log/app.log
chown app:adm /var/log/app.log

chmod 750 /var/log/app/
chown app:adm /var/log/app/
```

### 설정 파일

```bash
chmod 600 /etc/secret.conf
chown root:root /etc/secret.conf

chmod 644 /etc/myapp.conf
chown root:root /etc/myapp.conf
```

### 실행 파일

```bash
chmod 755 /usr/local/bin/script.sh
chown root:root /usr/local/bin/script.sh
```

웹 서버는 보통 `www-data` 또는 `apache` 사용자를 사용한다. 업로드 디렉토리는 쓰기 권한이 필요하지만 실행 권한은 제거한다.

## 보안 주의사항

### 위험한 권한 설정

```bash
# 절대 사용하지 말 것
chmod 777 /var/www
chmod 666 /etc/passwd
chown user:user /etc/shadow
chmod +s /tmp/script.sh
```

### 안전한 권한 설정 원칙

1. 최소 권한 원칙: 필요한 최소한의 권한만 부여
2. 소유자 확인: 파일 소유자가 올바른지 확인
3. 그룹 관리: 적절한 그룹에 적절한 권한 부여
4. 정기 점검: 권한 설정을 정기적으로 확인
5. SetUID/SetGID 최소화: 필요한 경우에만 사용

프로덕션 환경에서는 권한 변경을 문서화하고 변경 이력을 관리한다.

### 권한 점검 스크립트

```bash
#!/bin/bash
# 위험한 권한 찾기

find /var/www -type f -perm 777
find / -type f -perm -4000 2>/dev/null  # SetUID 파일
find / -type f -perm -2000 2>/dev/null  # SetGID 파일
find / -nouser -o -nogroup 2>/dev/null  # 소유자가 없는 파일
```

## 웹 서버 디렉토리 권한 설정

```bash
chown -R www-data:www-data /var/www
chmod 755 /var/www
chmod 755 /var/www/html
chmod 775 /var/www/uploads
chmod g+s /var/www/uploads
find /var/www/html -type f -exec chmod 644 {} \;
find /var/www/html -type d -exec chmod 755 {} \;
```

업로드 디렉토리는 쓰기 권한이 필요하지만 실행 권한은 제거한다. SetGID를 설정하면 새 파일이 그룹을 상속받는다.

## 공유 디렉토리 권한 설정

```bash
chgrp -R developers /shared/team
chmod 775 /shared/team
chmod g+s /shared/team
umask 002
```

SetGID를 설정하면 새로 생성된 파일이 디렉토리 그룹을 상속받는다. umask 002는 그룹 쓰기를 허용한다.
