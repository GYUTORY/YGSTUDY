---
title: 사용자 및 권한 관리
tags: [linux, user, group, sudo, su, permission]
updated: 2025-12-08
---

# 사용자 및 권한 관리

## 개요

사용자와 그룹 생성 및 관리 방법. 최소 권한 원칙을 따른다. root 권한은 필요한 경우에만 사용한다.

## 사용자 관리

### useradd

새 사용자를 생성한다.

```bash
useradd username
useradd -m username                 # 홈 디렉토리 생성
useradd -s /bin/bash username
useradd -g groupname username
useradd -G group1,group2 username
useradd -u 1001 username
useradd -c "User Name" username
```

`-m` 옵션으로 홈 디렉토리를 자동 생성한다. 일반적으로 필수다.

### usermod

사용자 정보를 수정한다.

```bash
usermod -s /bin/zsh username
usermod -g newgroup username
usermod -G group1,group2 username
usermod -aG groupname username      # 그룹 추가 (기존 그룹 유지)
usermod -L username                 # 계정 잠금
usermod -U username
usermod -e 2025-12-31 username
```

`-aG`는 기존 그룹에 추가한다. `-G`만 사용하면 기존 그룹이 제거된다.

### userdel

사용자를 삭제한다.

```bash
userdel username
userdel -r username                 # 홈 디렉토리도 삭제
```

`-r` 옵션은 홈 디렉토리와 메일 스풀도 삭제한다. 신중하게 사용한다.

### passwd

사용자 비밀번호를 설정한다.

```bash
passwd                             # 자신의 비밀번호 변경
passwd username                    # 다른 사용자 비밀번호 변경 (root)
passwd -l username                 # 계정 잠금
passwd -u username
passwd -e username                 # 비밀번호 만료 강제
passwd -S username
```

비밀번호 정책을 설정하여 보안을 강화한다.

### id

사용자 ID 정보를 확인한다.

```bash
id
id username
id -u                              # UID만
id -g                              # GID만
id -G                              # 모든 그룹 ID
```

### whoami

현재 사용자 이름을 확인한다.

```bash
whoami
```

### w / who

현재 로그인한 사용자를 확인한다.

```bash
w                                  # 로그인 사용자와 활동
who
whoami
```

## 그룹 관리

### groupadd

새 그룹을 생성한다.

```bash
groupadd groupname
groupadd -g 1001 groupname
```

### groupmod

그룹 정보를 수정한다.

```bash
groupmod -n newname oldname
groupmod -g 1002 groupname
```

### groupdel

그룹을 삭제한다.

```bash
groupdel groupname
```

그룹에 사용자가 있으면 삭제할 수 없다. 먼저 사용자를 제거한다.

### groups

사용자가 속한 그룹을 확인한다.

```bash
groups
groups username
```

## 권한 상승

### su (Switch User)

다른 사용자로 전환한다.

```bash
su                                 # root로 전환
su -                               # root로 전환 (환경 변수 포함)
su username
su - username
su -c "command"
```

`-` 옵션은 로그인 쉘로 실행하여 환경 변수를 로드한다.

### sudo

다른 사용자 권한으로 명령어를 실행한다.

```bash
sudo command
sudo -u username command
sudo -i                            # root 쉘로 전환
sudo -s                            # root 쉘로 전환 (환경 변수 유지)
sudo -l                            # 허용된 명령어 목록
sudo -v
```

`sudo`는 명령어별로 권한을 제어할 수 있어 `su`보다 안전하다.

### sudoers 파일

`/etc/sudoers`에서 sudo 권한을 설정한다.

```bash
# 사용자에게 모든 권한
username ALL=(ALL) ALL

# 특정 명령어만 허용
username ALL=(ALL) /usr/bin/systemctl, /usr/bin/docker

# 비밀번호 없이 실행
username ALL=(ALL) NOPASSWD: ALL

# 특정 그룹에 권한
%groupname ALL=(ALL) ALL
```

**편집:**
```bash
visudo
```

`visudo`는 문법 검사를 하므로 직접 편집하지 않는다.

## 사용자 정보 파일

### /etc/passwd

사용자 계정 정보를 저장한다.

```bash
cat /etc/passwd
```

**필드:**
- 사용자명
- 비밀번호 (x는 /etc/shadow 사용)
- UID
- GID
- 설명
- 홈 디렉토리
- 기본 쉘

### /etc/shadow

비밀번호 해시를 저장한다.

```bash
sudo cat /etc/shadow
```

일반 사용자는 읽을 수 없다. 보안상 중요한 파일이다.

### /etc/group

그룹 정보를 저장한다.

```bash
cat /etc/group
```

**필드:**
- 그룹명
- 비밀번호 (x는 /etc/gshadow 사용)
- GID
- 멤버 목록

## 사용자 환경 설정

### 홈 디렉토리

```bash
~
$HOME
cd ~
```

### 쉘 설정 파일

```bash
~/.bashrc                          # bash 설정 (비로그인 쉘)
~/.bash_profile                    # bash 설정 (로그인 쉘)
~/.profile
~/.bash_logout
```

환경 변수는 `.bashrc`나 `.bash_profile`에 설정한다.

## 사용자 제한

### /etc/security/limits.conf

사용자별 리소스 제한을 설정한다.

```bash
# /etc/security/limits.conf
username soft nofile 4096
username hard nofile 8192
* soft nproc 4096
```

**제한 유형:**
- nofile: 열 수 있는 파일 수
- nproc: 프로세스 수
- memlock: 메모리 잠금
- fsize: 파일 크기

서비스별로 리소스 제한을 설정하여 시스템 보호한다.

### ulimit

현재 세션의 리소스 제한을 확인하고 설정한다.

```bash
ulimit -a
ulimit -n
ulimit -n 4096
ulimit -u
ulimit -u 1024
```

스크립트에서 리소스 제한을 설정할 때 사용한다.

## SSH 키 관리

### SSH 키 생성

```bash
ssh-keygen -t rsa
ssh-keygen -t ed25519
ssh-keygen -f ~/.ssh/id_rsa
```

### SSH 키 복사

```bash
ssh-copy-id user@host
cat ~/.ssh/id_rsa.pub | ssh user@host "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

비밀번호 없이 SSH 접속하려면 공개키를 복사한다.

## 사용자 관리 모범 사례

### 최소 권한 원칙

- 필요한 최소한의 권한만 부여
- root 권한은 필요한 경우에만 사용
- sudo로 세밀한 권한 제어

### 정기 점검

```bash
# 사용자 목록 확인
cat /etc/passwd | cut -d: -f1

# 비밀번호 만료 확인
chage -l username

# 최근 로그인 확인
last username
```

### 보안 설정

```bash
# 비밀번호 정책 설정
# /etc/login.defs 수정

# SSH 설정
# /etc/ssh/sshd_config 수정
```

정기적으로 사용자 계정을 점검하고 불필요한 계정을 비활성화한다.
