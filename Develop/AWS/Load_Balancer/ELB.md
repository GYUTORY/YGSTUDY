# AWS Elastic Load Balancer (ELB) 🚀

## 📖 개요

**Elastic Load Balancer(ELB)**는 AWS에서 제공하는 로드 밸런싱 서비스로, 들어오는 트래픽을 여러 대상(EC2 인스턴스, 컨테이너, IP 주소 등)에 자동으로 분산시켜 애플리케이션의 가용성과 확장성을 높여주는 서비스입니다.

### 🤔 로드 밸런서란?
- **정의**: 여러 서버에 트래픽을 균등하게 분배하는 장치
- **목적**: 서버 부하 분산, 고가용성 확보, 사용자 경험 개선
- **비유**: 은행 창구에서 고객을 여러 창구로 안내하는 직원과 같은 역할

## 🎯 ELB의 주요 역할

### 1. **트래픽 분산**
- 들어오는 요청을 여러 서버에 균등하게 분배
- 특정 서버에 과부하가 걸리지 않도록 방지

### 2. **고가용성 확보**
- 서버 장애 시 자동으로 다른 정상 서버로 트래픽 전환
- 사용자는 서비스 중단을 경험하지 않음

### 3. **확장성 지원**
- 트래픽 증가 시 자동으로 새로운 서버 추가
- 트래픽 감소 시 불필요한 서버 제거

## 🔧 ELB의 4가지 유형

### 1. **Application Load Balancer (ALB)** - 7계층
**📋 기본 정보**
- **계층**: 7계층 (Application Layer)
- **프로토콜**: HTTP, HTTPS, gRPC
- **특징**: 가장 지능적이고 유연한 라우팅

**🎯 주요 기능**
- **Path-based 라우팅**: URL 경로별로 다른 서비스로 라우팅
  - 예: `/api/*` → API 서버, `/web/*` → 웹 서버
- **Host-based 라우팅**: 도메인별로 다른 서비스로 라우팅
  - 예: `api.example.com` → API 서버, `www.example.com` → 웹 서버
- **Query string 기반 라우팅**: URL 파라미터에 따른 라우팅
- **HTTP 헤더 기반 라우팅**: 헤더 정보에 따른 라우팅

**💡 사용 사례**
- 웹 애플리케이션
- 마이크로서비스 아키텍처
- 컨테이너 기반 애플리케이션 (ECS/EKS)

### 2. **Network Load Balancer (NLB)** - 4계층
**📋 기본 정보**
- **계층**: 4계층 (Transport Layer)
- **프로토콜**: TCP, UDP, TLS
- **특징**: 초고성능, 초저지연

**🎯 주요 기능**
- **고정 IP 주소**: ALB와 달리 고정 IP 할당 가능
- **초저지연**: TCP 레벨에서 직접 처리하여 지연 시간 최소화
- **초고성능**: 초당 수백만 요청 처리 가능
- **TCP 연결 유지**: 클라이언트와 서버 간 연결 유지

**💡 사용 사례**
- 게임 서버
- 실시간 스트리밍
- TCP/UDP 기반 애플리케이션
- 고정 IP가 필요한 서비스

### 3. **Gateway Load Balancer (GWLB)** - 3계층
**📋 기본 정보**
- **계층**: 3계층 (Network Layer)
- **프로토콜**: IP 패킷
- **특징**: 네트워크 보안 장비 전용

**🎯 주요 기능**
- **네트워크 가시성**: 모든 트래픽을 보안 장비로 라우팅
- **중앙화된 보안**: 방화벽, IDS/IPS 등 보안 장비 통합
- **투명한 프록시**: 애플리케이션 변경 없이 보안 적용

**💡 사용 사례**
- 방화벽 배포
- 침입 탐지 시스템 (IDS)
- 침입 방지 시스템 (IPS)
- DDoS 보호 서비스

### 4. **Classic Load Balancer (CLB)** - 레거시
**📋 기본 정보**
- **계층**: 4계층 & 7계층 지원
- **프로토콜**: HTTP, HTTPS, TCP, SSL
- **특징**: AWS의 첫 번째 로드 밸런서 (레거시)

**⚠️ 주의사항**
- 새로운 프로젝트에서는 권장하지 않음
- 기존 시스템과의 호환성을 위해 유지
- 기능이 제한적이고 성능이 상대적으로 낮음

## 🔄 ELB 유형 비교표

| 구분 | ALB | NLB | GWLB | CLB |
|------|-----|-----|------|-----|
| **계층** | 7계층 | 4계층 | 3계층 | 4/7계층 |
| **프로토콜** | HTTP/HTTPS/gRPC | TCP/UDP/TLS | IP 패킷 | HTTP/HTTPS/TCP/SSL |
| **고정 IP** | ❌ | ✅ | ✅ | ❌ |
| **지연 시간** | 보통 | 매우 낮음 | 낮음 | 높음 |
| **성능** | 보통 | 매우 높음 | 높음 | 낮음 |
| **컨테이너 지원** | ✅ | ✅ | ❌ | ❌ |
| **Lambda 통합** | ✅ | ❌ | ❌ | ❌ |
| **고급 라우팅** | ✅ | ❌ | ❌ | ❌ |
| **비용** | 보통 | 높음 | 보통 | 낮음 |

## 🏗️ ELB 아키텍처 구성요소

### 1. **리스너 (Listener)**
- **정의**: 클라이언트 요청을 받는 포인트
- **설정**: 프로토콜, 포트, SSL 인증서
- **예시**: HTTPS 443 포트로 들어오는 요청 수신

### 2. **타겟 그룹 (Target Group)**
- **정의**: 실제 요청을 처리할 서버들의 그룹
- **대상**: EC2 인스턴스, IP 주소, Lambda 함수
- **기능**: 상태 확인, 로드 밸런싱 알고리즘 설정

### 3. **규칙 (Rule)**
- **정의**: 요청을 어떤 타겟 그룹으로 보낼지 결정하는 규칙
- **조건**: 경로, 호스트, 헤더 등
- **우선순위**: 규칙 간 우선순위 설정 가능

### 4. **보안 그룹 (Security Group)**
- **정의**: ELB에 대한 접근 제어
- **기능**: 허용할 IP, 포트, 프로토콜 설정

## 🔒 보안 기능

### 1. **SSL/TLS 종료**
- **개념**: 클라이언트와 ELB 간은 HTTPS, ELB와 서버 간은 HTTP
- **장점**: 서버 부하 감소, 인증서 관리 중앙화
- **설정**: AWS Certificate Manager(ACM) 통합

### 2. **AWS WAF 통합**
- **기능**: 웹 애플리케이션 방화벽
- **보호**: SQL 인젝션, XSS, DDoS 공격 방지
- **적용**: ALB에 WAF 규칙 적용

### 3. **보안 그룹**
- **역할**: 네트워크 레벨 접근 제어
- **설정**: 인바운드/아웃바운드 규칙
- **예시**: 특정 IP에서만 접근 허용

## 💰 비용 구조

### 1. **시간당 요금**
- ELB가 활성화된 시간에 따라 과금
- 유형별로 다른 요금 체계

### 2. **데이터 처리 요금**
- 처리된 데이터 양에 따른 과금
- 리전별로 다른 요금

### 3. **LCU (Load Balancer Capacity Units)**
- ALB의 경우 LCU 기반 과금
- 요청 수, 처리된 바이트, 활성 연결 수에 따라 계산

## 📊 모니터링 및 로깅

### 1. **CloudWatch 통합**
- **메트릭**: 요청 수, 지연 시간, 오류율 등
- **대시보드**: 실시간 모니터링
- **알람**: 임계값 초과 시 알림

### 2. **액세스 로그**
- **기능**: 모든 요청에 대한 상세 로그
- **저장**: S3에 로그 저장
- **분석**: 로그 분석 도구 활용

### 3. **상태 확인 (Health Check)**
- **목적**: 백엔드 서버의 상태 모니터링
- **방법**: HTTP/HTTPS 요청으로 서버 상태 확인
- **설정**: 경로, 포트, 간격, 임계값 설정

## ⭐ 모범 사례

### 1. **고가용성 구성**
- **다중 AZ**: 최소 2개 이상의 가용영역 사용
- **크로스 존 로드 밸런싱**: AZ 간 트래픽 분산
- **자동 장애 조치**: 서버 장애 시 자동 전환

### 2. **보안 강화**
- **HTTPS 강제**: 모든 트래픽을 HTTPS로 리다이렉트
- **최신 TLS**: TLS 1.2 이상 사용
- **보안 그룹**: 최소 권한 원칙 적용
- **WAF 규칙**: 적절한 WAF 규칙 적용

### 3. **성능 최적화**
- **적절한 타겟 그룹**: 서비스별 타겟 그룹 분리
- **효율적인 상태 확인**: 적절한 간격과 임계값 설정
- **캐싱 전략**: CloudFront와 연동하여 캐싱 활용

### 4. **비용 최적화**
- **불필요한 ELB 제거**: 사용하지 않는 ELB 삭제
- **적절한 유형 선택**: 사용 사례에 맞는 ELB 유형 선택
- **리소스 모니터링**: 사용량 모니터링을 통한 비용 관리

## ⚠️ 제한사항 및 고려사항

### 1. **서비스 제한**
- **리전당 최대 ELB 수**: 계정별 제한
- **리스너당 규칙 수**: ALB의 경우 제한
- **타겟 그룹당 타겟 수**: 최대 타겟 수 제한

### 2. **성능 고려사항**
- **지연 시간**: ALB는 상대적으로 높은 지연 시간
- **연결 제한**: 동시 연결 수 제한
- **처리량**: 초당 요청 처리 수 제한

### 3. **비용 고려사항**
- **시간당 요금**: 사용하지 않아도 요금 발생
- **데이터 전송 비용**: AZ 간 데이터 전송 시 추가 비용
- **WAF 비용**: WAF 사용 시 추가 비용

## 🎯 선택 가이드

### **ALB를 선택해야 하는 경우**
- ✅ HTTP/HTTPS 기반 웹 애플리케이션
- ✅ 마이크로서비스 아키텍처
- ✅ 컨테이너 기반 애플리케이션 (ECS/EKS)
- ✅ 고급 라우팅이 필요한 경우
- ✅ Lambda 함수와 통합이 필요한 경우

### **NLB를 선택해야 하는 경우**
- ✅ TCP/UDP 기반 애플리케이션
- ✅ 고정 IP 주소가 필요한 경우
- ✅ 초저지연이 필요한 경우 (게임, 실시간 스트리밍)
- ✅ 초고성능이 필요한 경우
- ✅ TCP 연결 유지가 중요한 경우

### **GWLB를 선택해야 하는 경우**
- ✅ 네트워크 보안 장비 배포
- ✅ 트래픽 검사 및 필터링
- ✅ 중앙화된 보안 관리
- ✅ 투명한 프록시가 필요한 경우

### **CLB를 선택해야 하는 경우**
- ✅ EC2-Classic 네트워크 사용
- ✅ 레거시 애플리케이션과의 호환성
- ✅ 간단한 로드 밸런싱만 필요한 경우

## 🔧 실제 구성 예시

### **웹 애플리케이션 구성**
```
인터넷 → ALB → EC2 인스턴스 (웹 서버)
                → EC2 인스턴스 (웹 서버)
                → EC2 인스턴스 (웹 서버)
```

### **마이크로서비스 구성**
```
인터넷 → ALB → /api/users → User Service
                → /api/orders → Order Service
                → /api/products → Product Service
```

### **게임 서버 구성**
```
게임 클라이언트 → NLB → Game Server 1
                           → Game Server 2
                           → Game Server 3
```

## 📚 추가 학습 리소스

### **AWS 공식 문서**
- [Elastic Load Balancing 사용 설명서](https://docs.aws.amazon.com/elasticloadbalancing/)
- [Application Load Balancer](https://docs.aws.amazon.com/elasticloadbalancing/latest/application/)
- [Network Load Balancer](https://docs.aws.amazon.com/elasticloadbalancing/latest/network/)

### **실습 가이드**
- AWS 콘솔에서 ELB 생성 및 구성
- 다양한 라우팅 규칙 설정
- 상태 확인 및 모니터링 설정

## 🎉 결론

AWS Elastic Load Balancer는 클라우드 환경에서 애플리케이션의 가용성과 확장성을 보장하는 핵심 서비스입니다. 각 유형별 특징을 이해하고 사용 사례에 맞는 적절한 선택을 통해 최적의 성능과 비용 효율성을 달성할 수 있습니다.

**핵심 포인트:**
- 🎯 **목적에 맞는 선택**: 사용 사례에 따라 적절한 ELB 유형 선택
- 🔒 **보안 우선**: HTTPS, WAF, 보안 그룹 적절히 구성
- 📊 **모니터링 필수**: CloudWatch를 통한 지속적인 모니터링
- 💰 **비용 관리**: 사용량 모니터링을 통한 비용 최적화
