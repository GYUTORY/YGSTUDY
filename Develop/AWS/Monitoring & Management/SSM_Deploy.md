---
title: AWS SSM을 활용한 자동화 배포 실전 가이드
tags: [aws, monitoring-and-management, ssm, deployment, automation]
updated: 2025-09-23
---

# AWS SSM을 활용한 자동화 배포 실전 가이드

## 개요

최근 많은 기업들이 레거시 시스템의 한계를 극복하고자 DevOps 문화를 도입하고 있습니다. 특히 배포 과정에서 발생하는 수동 작업의 비효율성, 보안 취약점, 그리고 운영 안정성 문제를 해결하기 위해 자동화 도구들을 적극 활용하고 있습니다.

이 문서는 실제 프로덕션 환경에서 Bitbucket Pipeline과 AWS SSM(Systems Manager)을 연동하여 Node.js 20 기반 애플리케이션의 자동화 배포 시스템을 구축한 경험을 바탕으로 작성되었습니다. 단순한 설정 방법을 나열하는 것이 아니라, 왜 이런 구조가 필요한지, 어떤 문제를 해결하는지에 대한 개념적 이해를 중심으로 다룹니다.

## 1. 기존 배포 방식의 문제점과 개선 필요성

### 1.1 레거시 배포 방식의 한계

기존의 수동 배포 방식은 여러 가지 구조적 문제를 가지고 있었습니다. 가장 큰 문제는 **인적 의존성**이었다. 개발자가 직접 서버에 SSH로 접속하여 git pull, npm install, pm2 restart 등의 명령을 순차적으로 실행하는 방식은 다음과 같은 문제점들을 야기했습니다.

**일관성 부족**: 개발자마다 배포 절차가 미묘하게 달랐습니다. 어떤 개발자는 npm install을 먼저 실행하고, 어떤 개발자는 git pull 후 바로 pm2 restart를 실행했습니다. 이런 불일치는 예측하기 어려운 배포 실패로 이어졌습니다.

**권한 관리의 복잡성**: 모든 개발자에게 동일한 SSH 접근 권한을 부여해야 했습니다. 이는 보안상 위험할 뿐만 아니라, 누가 언제 어떤 작업을 했는지 추적하기 어려웠습니다. 특히 장애 발생 시 원인 파악에 상당한 시간이 소요되었습니다.

**배포 이력의 부재**: 수동 배포는 추적 가능한 이력이 남지 않았습니다. 어떤 버전이 언제 배포되었는지, 누가 배포했는지에 대한 기록이 없어 롤백이나 문제 해결이 어려웠습니다.

**민감 정보 노출**: 데이터베이스 비밀번호, API 키 등의 민감한 정보가 코드나 서버 설정 파일에 평문으로 저장되어 있었습니다. 이는 보안 사고의 주요 원인이 될 수 있었습니다.

### 1.2 자동화 배포의 필요성

이러한 문제들을 해결하기 위해 자동화 배포 시스템이 필요했습니다. 자동화 배포의 핵심 목표는 다음과 같았습니다:

**일관성 확보**: 모든 배포가 동일한 절차를 거치도록 하여 예측 가능한 결과를 보장합니다.

**보안 강화**: 최소 권한 원칙을 적용하고, 민감 정보는 암호화하여 안전하게 관리합니다.

**추적성 확보**: 모든 배포 과정이 로그로 남아 감사와 문제 해결이 가능합니다.

**효율성 증대**: 수동 작업을 최소화하여 개발팀의 생산성을 높입니다.

## 2. AWS SSM의 핵심 개념과 역할

### 2.1 SSM(Systems Manager)이란?

AWS Systems Manager는 AWS 리소스를 관리하고 운영 작업을 자동화할 수 있는 서비스입니다. SSM의 핵심 기능 중 하나가 **Run Command**인데, 이는 EC2 인스턴스에 원격으로 명령을 실행할 수 있게 해줍니다.

SSM의 가장 큰 장점은 **에이전트 기반 관리**입니다. EC2 인스턴스에 SSM Agent가 설치되어 있으면, SSH 접속 없이도 AWS 콘솔이나 CLI를 통해 인스턴스에 명령을 실행할 수 있습니다. 이는 보안상 매우 중요한 의미를 가집니다.

### 2.2 SSM Agent의 동작 원리

SSM Agent는 EC2 인스턴스에서 실행되는 소프트웨어입니다. 이 에이전트는 AWS SSM 서비스와 지속적으로 통신하여 대기 중인 명령이 있는지 확인합니다. 명령이 있으면 해당 명령을 실행하고 결과를 SSM 서비스로 전송합니다.

이 과정에서 중요한 것은 **역방향 연결**입니다. 일반적인 SSH는 클라이언트가 서버에 직접 연결하는 방식이지만, SSM Agent는 서버(EC2)에서 AWS 서비스로 연결을 시작합니다. 이는 방화벽 설정을 단순화하고 보안을 강화하는 효과가 있습니다.

### 2.3 Parameter Store의 역할

SSM Parameter Store는 설정 데이터와 민감한 정보를 안전하게 저장할 수 있는 서비스입니다. 특히 **SecureString** 타입을 사용하면 KMS(Key Management Service)를 통해 자동으로 암호화됩니다.

Parameter Store의 장점은 **중앙 집중식 관리**입니다. 여러 서버에서 동일한 설정값을 사용해야 할 때, 각 서버에 개별적으로 설정하지 않고 Parameter Store에서 중앙 관리할 수 있습니다. 또한 설정값 변경 시 모든 서버에 즉시 반영할 수 있습니다.

## 3. 보안 아키텍처 설계

### 3.1 IAM 최소 권한 원칙

자동화 배포 시스템에서 가장 중요한 보안 원칙은 **최소 권한 원칙(Principle of Least Privilege)**입니다. 이는 각 구성 요소가 자신의 역할을 수행하는 데 필요한 최소한의 권한만을 부여하는 것입니다.

EC2 인스턴스에 부여되는 IAM Role은 다음과 같은 권한만을 포함해야 합니다:
- `ssm:SendCommand`: SSM을 통해 명령 실행
- `ssm:GetParameters`: Parameter Store에서 설정값 조회
- `kms:Decrypt`: 암호화된 파라미터 복호화
- `logs:CreateLogGroup`, `logs:PutLogEvents`: CloudWatch Logs에 로그 전송

이러한 세분화된 권한 부여는 보안 사고 발생 시 피해 범위를 최소화하고, 감사 시에도 어떤 권한이 사용되었는지 명확히 파악할 수 있게 합니다.

### 3.2 KMS를 활용한 암호화

민감한 정보는 반드시 암호화되어야 합니다. AWS에서는 KMS(Key Management Service)를 통해 강력한 암호화를 제공합니다. KMS의 핵심 특징은 다음과 같습니다:

**고객 관리 키**: AWS가 제공하는 기본 키 대신 고객이 직접 생성하고 관리하는 키를 사용할 수 있습니다. 이를 통해 키의 생성, 삭제, 권한 관리에 대한 완전한 제어가 가능합니다.

**키 정책**: KMS 키는 정책을 통해 어떤 주체가 어떤 작업을 수행할 수 있는지 세밀하게 제어할 수 있습니다. 예를 들어, 특정 IAM Role만 복호화를 수행할 수 있도록 제한할 수 있습니다.

**감사 추적**: KMS는 모든 키 사용에 대한 상세한 로그를 CloudTrail을 통해 제공합니다. 이를 통해 누가 언제 어떤 키를 사용했는지 완전히 추적할 수 있습니다.

### 3.3 네트워크 보안 설계

EC2 인스턴스는 가능한 한 **프라이빗 서브넷**에 배치해야 합니다. 프라이빗 서브넷은 인터넷에서 직접 접근할 수 없으며, NAT Gateway를 통해서만 외부와 통신할 수 있습니다.

이러한 설계의 장점은 다음과 같습니다:
- **공격 표면 최소화**: 외부에서 직접 접근할 수 없어 공격 가능성이 크게 줄어듭니다.
- **SSM을 통한 관리**: SSH 접속이 불가능하더라도 SSM을 통해 모든 관리 작업이 가능합니다.
- **VPC 엔드포인트 활용**: AWS 서비스와의 통신을 VPC 내부에서 처리할 수 있어 보안과 성능을 동시에 확보할 수 있습니다.

## 4. CI/CD 파이프라인 설계

### 4.1 Bitbucket Pipeline의 역할

Bitbucket Pipeline은 코드 저장소와 연동된 CI/CD 서비스입니다. 코드가 저장소에 푸시되거나 특정 브랜치에 머지될 때 자동으로 파이프라인이 실행됩니다.

파이프라인의 핵심 역할은 다음과 같습니다:
- **코드 품질 검증**: 테스트 실행, 코드 스타일 검사 등
- **빌드 및 패키징**: 애플리케이션 빌드, 의존성 설치 등
- **배포 자동화**: AWS SSM을 통한 원격 배포 실행

### 4.2 환경 변수 관리

Bitbucket Pipeline에서는 **환경 변수**를 통해 민감한 정보를 안전하게 관리할 수 있습니다. 환경 변수는 코드에 직접 노출되지 않으며, 파이프라인 실행 시에만 사용됩니다.

주요 환경 변수들:
- `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`: AWS 자격 증명
- `AWS_DEFAULT_REGION`: AWS 리전 정보
- `INSTANCE_ID`: 배포 대상 EC2 인스턴스 ID
- `DEPLOY_ENV`: 배포 환경 (dev, staging, production)

### 4.3 배포 스크립트 설계

배포 스크립트는 실제 애플리케이션 배포를 담당하는 핵심 구성 요소입니다. 좋은 배포 스크립트는 다음과 같은 특징을 가져야 합니다:

**멱등성(Idempotency)**: 동일한 스크립트를 여러 번 실행해도 동일한 결과를 보장해야 합니다. 이를 위해 현재 상태를 확인하고 필요한 작업만 수행해야 합니다.

**오류 처리**: 각 단계에서 발생할 수 있는 오류를 적절히 처리하고, 실패 시 명확한 오류 메시지를 제공해야 합니다.

**롤백 지원**: 배포 실패 시 이전 상태로 복구할 수 있는 메커니즘을 포함해야 합니다.

## 5. 모니터링 및 로깅

### 5.1 CloudWatch Logs 활용

모든 배포 과정과 애플리케이션 로그는 CloudWatch Logs에 중앙 집중식으로 수집됩니다. 이를 통해 다음과 같은 이점을 얻을 수 있습니다:

**통합 로그 관리**: 여러 서버의 로그를 하나의 곳에서 관리할 수 있습니다.

**실시간 모니터링**: CloudWatch 알람을 설정하여 특정 조건이 발생했을 때 즉시 알림을 받을 수 있습니다.

**로그 분석**: CloudWatch Insights를 사용하여 로그 데이터를 분석하고 문제를 진단할 수 있습니다.

### 5.2 배포 이력 추적

모든 배포는 추적 가능한 이력을 남겨야 합니다. 이를 위해 다음과 같은 정보를 기록합니다:

- 배포 시작/완료 시간
- 배포한 사용자 (Git 커밋 정보)
- 배포된 코드 버전 (Git 커밋 해시)
- 배포 결과 (성공/실패)
- 배포 과정에서 발생한 오류

이러한 정보는 Bitbucket, SSM, CloudWatch Logs 등 여러 곳에 분산되어 기록되며, 필요 시 통합하여 조회할 수 있습니다.

## 6. 환경별 분리 전략

### 6.1 환경 분리의 필요성

개발, 스테이징, 프로덕션 환경은 서로 다른 목적과 요구사항을 가지고 있습니다. 따라서 각 환경은 독립적으로 관리되어야 합니다.

**개발 환경**: 빠른 반복 개발을 위해 자동화된 배포가 중요합니다.
**스테이징 환경**: 프로덕션과 유사한 환경에서 최종 테스트를 수행합니다.
**프로덕션 환경**: 안정성과 보안이 최우선이며, 신중한 배포가 필요합니다.

### 6.2 환경별 리소스 분리

각 환경은 다음과 같은 리소스를 독립적으로 가져야 합니다:

**AWS 계정 분리**: 가능하다면 환경별로 별도의 AWS 계정을 사용하는 것이 가장 안전합니다.

**IAM 정책 분리**: 각 환경별로 독립적인 IAM 정책과 역할을 생성합니다.

**KMS 키 분리**: 환경별로 별도의 KMS 키를 사용하여 암호화를 수행합니다.

**SSM 파라미터 분리**: 환경별로 다른 네임스페이스를 사용하여 파라미터를 구분합니다.

## 7. 장애 대응 및 롤백 전략

### 7.1 장애 감지

자동화된 배포 시스템에서는 장애를 빠르게 감지하고 대응하는 것이 중요합니다. 다음과 같은 방법으로 장애를 감지할 수 있습니다:

**헬스 체크**: 배포 후 애플리케이션이 정상적으로 응답하는지 확인합니다.

**메트릭 모니터링**: CPU, 메모리, 네트워크 등의 시스템 메트릭을 모니터링합니다.

**로그 분석**: 오류 로그나 예외 상황을 실시간으로 분석합니다.

### 7.2 자동 롤백

배포 실패 시 자동으로 이전 버전으로 롤백하는 메커니즘을 구축해야 합니다. 롤백 전략은 다음과 같습니다:

**Git 태그 활용**: 각 배포마다 Git 태그를 생성하여 이전 버전을 쉽게 식별할 수 있도록 합니다.

**데이터베이스 마이그레이션 롤백**: 데이터베이스 스키마 변경이 포함된 경우, 롤백 스크립트를 미리 준비합니다.

**설정 복원**: 환경 설정이나 파라미터 변경사항도 함께 롤백해야 합니다.

## 8. 실전 운영 경험

### 8.1 초기 구축 시 주의사항

자동화 배포 시스템을 처음 구축할 때는 다음과 같은 점들을 주의해야 합니다:

**점진적 도입**: 모든 것을 한 번에 자동화하려 하지 말고, 단계적으로 도입합니다. 먼저 개발 환경에서 시작하여 안정화된 후 스테이징, 프로덕션 순으로 확장합니다.

**충분한 테스트**: 실제 배포 전에 다양한 시나리오를 테스트합니다. 특히 실패 상황에 대한 테스트가 중요합니다.

**문서화**: 모든 설정과 절차를 상세히 문서화합니다. 팀원들이 쉽게 이해하고 유지보수할 수 있도록 합니다.

### 8.2 운영 중 발생하는 문제들

실제 운영 중에는 다음과 같은 문제들이 발생할 수 있습니다:

**SSM Agent 장애**: 네트워크 문제나 IAM 권한 문제로 SSM Agent가 정상 동작하지 않을 수 있습니다. 정기적인 헬스 체크가 필요합니다.

**KMS 권한 오류**: 키 정책 변경이나 IAM 권한 변경으로 인해 암호화된 파라미터에 접근하지 못할 수 있습니다.

**배포 스크립트 오류**: 환경 변화나 의존성 변경으로 인해 배포 스크립트가 실패할 수 있습니다.

### 8.3 지속적인 개선

자동화 배포 시스템은 한 번 구축하고 끝나는 것이 아닙니다. 지속적인 모니터링과 개선이 필요합니다:

**성능 최적화**: 배포 시간을 단축하고 리소스 사용량을 최적화합니다.

**보안 강화**: 새로운 보안 위협에 대응하고 보안 정책을 업데이트합니다.

**사용성 개선**: 개발자들이 더 쉽게 사용할 수 있도록 인터페이스나 프로세스를 개선합니다.

## 결론

AWS SSM을 활용한 자동화 배포 시스템은 단순히 기술적 도구의 조합이 아닙니다. 이는 개발팀의 생산성을 높이고, 운영 안정성을 확보하며, 보안을 강화하는 종합적인 솔루션입니다.

가장 중요한 것은 **점진적 접근**입니다. 모든 것을 한 번에 완벽하게 구축하려 하지 말고, 작은 단위로 시작하여 점진적으로 확장해 나가는 것이 성공의 열쇠입니다. 또한 기술적 구현보다는 **팀의 문화와 프로세스**를 먼저 정립하는 것이 중요합니다.

자동화는 목적이 아니라 수단입니다. 궁극적인 목표는 더 안정적이고 효율적인 소프트웨어 개발과 운영을 통해 사용자에게 더 나은 서비스를 제공하는 것입니다.

## 참조

- AWS Systems Manager 공식 문서: https://docs.aws.amazon.com/systems-manager/
- AWS KMS 공식 문서: https://docs.aws.amazon.com/kms/
- Bitbucket Pipelines 공식 문서: https://support.atlassian.com/bitbucket-cloud/docs/get-started-with-bitbucket-pipelines/
- AWS Well-Architected Framework: https://aws.amazon.com/architecture/well-architected/
- DevOps 핸드북: https://itrevolution.com/the-devops-handbook/
- AWS 보안 모범 사례: https://aws.amazon.com/security/security-resources/
- Node.js 프로덕션 모범 사례: https://nodejs.org/en/docs/guides/nodejs-docker-webapp/
- 마이크로서비스 아키텍처 패턴: https://microservices.io/
