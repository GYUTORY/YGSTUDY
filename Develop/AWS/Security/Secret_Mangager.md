# AWS Secret Manager란 무엇인가?

AWS Secret Manager(시크릿 매니저)는 AWS에서 제공하는 완전관리형 서비스로, 애플리케이션, 서비스, 사용자 계정 등에서 사용하는 민감한 정보(시크릿)를 안전하게 저장, 관리, 검색할 수 있도록 도와줍니다. 여기서 시크릿이란 데이터베이스 자격 증명, API 키, OAuth 토큰, 기타 중요한 설정 값 등 외부에 노출되어서는 안 되는 민감한 정보를 의미합니다.

## 왜 Secret Manager가 필요한가?

현대의 애플리케이션은 다양한 외부 서비스와 연동되며, 이 과정에서 여러 인증 정보와 키를 사용합니다. 만약 이런 정보가 코드에 하드코딩되거나, 안전하지 않은 방식으로 관리된다면 보안 사고로 이어질 수 있습니다. 실제로 많은 보안 사고가 소스코드에 노출된 자격 증명이나 키로 인해 발생합니다. Secret Manager는 이런 위험을 줄이고, 다음과 같은 이점을 제공합니다.

- **중앙 집중화된 시크릿 관리**: 여러 애플리케이션, 서비스, 환경에서 사용하는 시크릿을 한 곳에서 관리할 수 있습니다.
- **자동화된 시크릿 교체(로테이션)**: 주기적으로 시크릿을 자동으로 변경하여 보안성을 높일 수 있습니다.
- **접근 제어 및 감사**: 누가 언제 어떤 시크릿에 접근했는지 추적할 수 있고, IAM 정책을 통해 접근 권한을 세밀하게 제어할 수 있습니다.
- **암호화 및 복호화 자동 처리**: 저장되는 모든 시크릿은 자동으로 암호화되며, 필요할 때만 복호화되어 제공됩니다.

## Secret Manager의 주요 기능

### 1. 시크릿 저장 및 검색
Secret Manager는 민감한 정보를 안전하게 저장하고, 필요할 때 API 또는 AWS SDK를 통해 안전하게 검색할 수 있도록 지원합니다. 예를 들어, 데이터베이스 비밀번호를 Secret Manager에 저장해두고, 애플리케이션이 실행될 때마다 Secret Manager에서 비밀번호를 안전하게 받아와 사용할 수 있습니다.

### 2. 시크릿 자동 로테이션
시크릿은 시간이 지남에 따라 노출 위험이 커질 수 있습니다. Secret Manager는 Lambda 함수를 이용해 시크릿을 주기적으로 자동 교체(로테이션)할 수 있는 기능을 제공합니다. 예를 들어, 데이터베이스 비밀번호를 30일마다 자동으로 변경하고, 변경된 비밀번호를 애플리케이션에 자동으로 반영할 수 있습니다.

### 3. 접근 제어
AWS IAM(Identity and Access Management)과 연동하여, 누가 어떤 시크릿에 접근할 수 있는지 세밀하게 제어할 수 있습니다. 예를 들어, 특정 애플리케이션만 특정 시크릿에 접근하도록 제한할 수 있습니다.

### 4. 감사 및 로깅
AWS CloudTrail과 연동하여, 시크릿에 대한 접근 이력을 모두 기록할 수 있습니다. 누가 언제 어떤 시크릿을 조회, 생성, 변경, 삭제했는지 추적할 수 있어 보안 감사에 유용합니다.

### 5. 암호화
Secret Manager에 저장되는 모든 시크릿은 AWS KMS(Key Management Service)를 이용해 암호화됩니다. 사용자는 기본 KMS 키를 사용하거나, 직접 생성한 KMS 키를 사용할 수 있습니다.

## Secret Manager의 사용 예시

### 1. 데이터베이스 자격 증명 관리
애플리케이션이 RDS, Aurora 등 AWS 데이터베이스에 접근할 때 필요한 사용자명과 비밀번호를 Secret Manager에 저장하고, 애플리케이션이 실행될 때마다 Secret Manager에서 안전하게 받아와 사용합니다.

### 2. API 키 및 토큰 관리
외부 API(예: Stripe, Twilio 등)와 연동할 때 필요한 API 키나 토큰을 Secret Manager에 저장하고, 필요할 때마다 안전하게 조회해 사용합니다.

### 3. 인증서 및 기타 민감 정보 관리
SSL 인증서, OAuth 클라이언트 시크릿 등 다양한 민감 정보를 Secret Manager에 저장해 관리할 수 있습니다.

## Secret Manager와 KMS의 차이점

Secret Manager와 KMS는 모두 보안과 관련된 AWS 서비스이지만, 목적과 역할이 다릅니다. 많은 사람들이 이 두 서비스를 혼동하는데, 아래에서 그 차이점을 명확히 설명하겠습니다.

### 1. AWS KMS(Key Management Service)란?
KMS는 암호화 키(Encryption Key)를 생성, 저장, 관리하는 서비스입니다. 즉, KMS는 "키" 자체를 안전하게 관리하고, 이 키를 이용해 데이터를 암호화/복호화하는 역할을 합니다. KMS는 다음과 같은 용도로 사용됩니다.

- S3, EBS, RDS 등 AWS 리소스의 데이터 암호화
- 애플리케이션에서 직접 데이터를 암호화/복호화할 때 사용
- Secret Manager, Parameter Store 등에서 시크릿을 암호화할 때 사용

### 2. Secret Manager와 KMS의 관계
Secret Manager는 시크릿(민감 정보)을 저장하는 서비스이고, 이 시크릿을 안전하게 보호하기 위해 내부적으로 KMS를 사용합니다. 즉, Secret Manager에 저장된 모든 시크릿은 KMS 키로 암호화되어 저장됩니다. 사용자는 Secret Manager를 통해 시크릿을 저장/조회하고, KMS는 그 시크릿을 암호화/복호화하는 역할을 합니다.

### 3. 주요 차이점 정리

| 구분 | Secret Manager | KMS |
|------|---------------|-----|
| 목적 | 시크릿(민감 정보) 저장 및 관리 | 암호화 키 관리 및 데이터 암호화/복호화 |
| 저장 대상 | 데이터베이스 비밀번호, API 키 등 | 암호화 키(CMK, Customer Master Key) |
| 주요 기능 | 시크릿 저장, 검색, 자동 로테이션, 접근 제어, 감사 | 키 생성, 관리, 접근 제어, 데이터 암호화/복호화 |
| 암호화 | 내부적으로 KMS를 사용 | 자체적으로 암호화 키를 관리 |
| 사용 예시 | DB 비밀번호, API 키, 인증서 등 | S3, EBS, RDS 데이터 암호화, Secret Manager 시크릿 암호화 |

### 4. 언제 Secret Manager를 쓰고, 언제 KMS를 써야 할까?

- **Secret Manager**는 민감한 정보를 저장하고, 주기적으로 교체(로테이션)하거나, 여러 애플리케이션에서 안전하게 공유해야 할 때 사용합니다. 예를 들어, 여러 서버에서 공통으로 사용하는 데이터베이스 비밀번호, API 키, 인증서 등을 안전하게 관리하고 싶을 때 적합합니다.
- **KMS**는 직접적으로 암호화/복호화가 필요한 데이터를 다룰 때 사용합니다. 예를 들어, 파일을 암호화해서 저장하거나, 특정 데이터를 암호화해서 전송해야 할 때, 또는 Secret Manager, S3, EBS 등에서 내부적으로 암호화가 필요할 때 사용합니다.

## Secret Manager의 실제 사용 시나리오

### 1. 애플리케이션에서 시크릿 조회

1. 애플리케이션이 실행될 때, Secret Manager의 API를 호출해 필요한 시크릿(예: DB 비밀번호)을 조회합니다.
2. Secret Manager는 해당 시크릿을 KMS로 복호화한 후, 애플리케이션에 전달합니다.
3. 애플리케이션은 전달받은 시크릿을 사용해 데이터베이스에 접속합니다.

이 과정에서 시크릿은 네트워크를 통해 암호화된 상태로 전달되며, 접근 권한이 없는 애플리케이션이나 사용자는 시크릿을 조회할 수 없습니다.

### 2. 시크릿 자동 로테이션

1. Secret Manager에 저장된 시크릿에 대해 로테이션 정책을 설정합니다.
2. 정해진 주기마다 Lambda 함수가 실행되어, 새로운 시크릿(예: 새로운 DB 비밀번호)을 생성합니다.
3. Lambda 함수는 데이터베이스에 접속해 비밀번호를 변경하고, 변경된 비밀번호를 Secret Manager에 저장합니다.
4. 이후 애플리케이션은 변경된 시크릿을 자동으로 받아와 사용합니다.

이렇게 하면 비밀번호가 주기적으로 자동 변경되어, 노출 위험을 최소화할 수 있습니다.

## Secret Manager의 장점과 한계

### 장점
- **보안성 강화**: 민감 정보가 코드나 환경 변수에 노출되지 않으므로, 보안 사고 위험이 크게 줄어듭니다.
- **운영 효율성**: 시크릿을 중앙에서 관리하고, 자동으로 교체할 수 있어 운영 부담이 줄어듭니다.
- **접근 제어 및 감사**: IAM, CloudTrail과 연동해 세밀한 접근 제어와 감사가 가능합니다.
- **AWS 서비스와의 통합**: Lambda, RDS, ECS, EKS 등 다양한 AWS 서비스와 쉽게 연동할 수 있습니다.

### 한계
- **비용**: Secret Manager는 저장된 시크릿 개수와 API 호출 횟수에 따라 비용이 발생합니다. 대규모 환경에서는 비용이 증가할 수 있습니다.
- **AWS 외부 연동 한계**: AWS 외부 시스템과 연동할 때는 별도의 인증 및 네트워크 설정이 필요할 수 있습니다.
- **로테이션 자동화 한계**: 모든 시크릿에 대해 자동 로테이션이 가능한 것은 아니며, 일부는 수동으로 관리해야 할 수 있습니다.

## Secret Manager와 Parameter Store의 차이

AWS에는 Secret Manager 외에도 Parameter Store라는 서비스가 있습니다. 둘 다 시크릿을 저장할 수 있지만, 주요 차이점은 다음과 같습니다.

| 구분 | Secret Manager | Parameter Store |
|------|---------------|----------------|
| 주요 목적 | 민감 정보(시크릿) 저장 | 설정 값, 비밀 값 저장 |
| 자동 로테이션 | 지원 | 미지원(수동) |
| 비용 | 유료 | 무료(기본), 고급은 유료 |
| 암호화 | KMS 기반 | KMS 기반(옵션) |
| 통합 기능 | Lambda 기반 로테이션, 감사 등 | 제한적 |

Parameter Store는 간단한 설정 값이나 비밀 값을 저장할 때 적합하고, Secret Manager는 자동 로테이션, 감사, 고급 보안 기능이 필요한 경우에 적합합니다.

## Secret Manager 사용 시 주의사항

1. **최소 권한 원칙 적용**: IAM 정책을 통해 시크릿에 접근할 수 있는 주체를 최소화해야 합니다.
2. **로테이션 정책 설정**: 가능한 한 모든 시크릿에 대해 주기적인 로테이션 정책을 적용해야 합니다.
3. **CloudTrail 연동**: 시크릿 접근 이력을 반드시 CloudTrail로 기록해, 이상 접근 시 즉시 대응할 수 있도록 해야 합니다.
4. **비용 모니터링**: 시크릿 개수와 API 호출 횟수를 주기적으로 모니터링해, 불필요한 비용이 발생하지 않도록 관리해야 합니다.

## 결론

AWS Secret Manager는 현대 애플리케이션에서 필수적인 시크릿(민감 정보) 관리 서비스를 제공합니다. KMS와의 차이점을 명확히 이해하고, 각 서비스의 목적에 맞게 활용한다면, 보안성과 운영 효율성을 모두 높일 수 있습니다. Secret Manager를 도입함으로써, 민감 정보의 노출 위험을 줄이고, 안전하고 효율적인 클라우드 환경을 구축할 수 있습니다.
 