# AWS KMS 완전정복! 🔐

안녕하세요! 오늘은 많은 분들이 궁금해하시는 AWS KMS(Key Management Service)에 대해 아주~ 자세하게 파헤쳐보려고 합니다. ☕️ 클라우드 보안에 관심이 있다면 꼭 알아야 할 서비스이니, 끝까지 읽어보시면 분명 도움이 될 거예요!

---

## 1. KMS란 무엇인가요? 🤔

KMS는 Key Management Service의 약자로, AWS에서 제공하는 완전관리형 키 관리 서비스입니다. 쉽게 말해, 데이터 암호화에 필요한 키를 안전하게 생성, 저장, 관리, 사용, 폐기까지 해주는 서비스죠. 🔑

### 1-1. 왜 KMS가 필요할까요?

클라우드 환경에서는 데이터가 여러 곳에 저장되고, 다양한 서비스와 연동됩니다. 이때 데이터가 유출되거나 변조되는 것을 막기 위해 암호화가 필수입니다. 하지만 암호화의 핵심인 "키"를 안전하게 관리하는 건 생각보다 어렵죠. 😅 그래서 AWS가 KMS를 만들어, 키 관리의 복잡함을 대신 해결해줍니다!

---

## 2. KMS의 주요 기능 🌟

### 2-1. 키 생성 및 관리
- 대칭키(Symmetric Key)와 비대칭키(Asymmetric Key) 모두 지원
- 키의 생성, 활성화/비활성화, 삭제, 로테이션 등 다양한 관리 기능 제공

### 2-2. 데이터 암호화/복호화
- KMS에서 직접 암호화/복호화 API 제공
- S3, EBS, RDS 등 AWS 서비스와 연동하여 자동 암호화 가능

### 2-3. 접근 제어
- IAM 정책, 키 정책, 그랜트(Grant) 등 다양한 방식으로 키 접근 권한 제어
- 세분화된 권한 설정으로 보안 강화

### 2-4. 감사 및 로깅
- CloudTrail과 연동하여 키 사용 이력 추적 가능
- 누가, 언제, 어떤 키를 사용했는지 확인 가능 👀

---

## 3. KMS의 구조와 용어 정리 🏗️

### 3-1. CMK(Customer Master Key)
- KMS에서 관리하는 주요 암호화 키
- 실제 데이터 암호화에 직접 사용되기보다는, 데이터 키(Data Key)를 암호화하는 데 사용됨

### 3-2. 데이터 키(Data Key)
- 실제 데이터 암호화/복호화에 사용되는 일회성 키
- CMK로 암호화되어 저장됨

### 3-3. 키 정책(Key Policy)
- 각 키에 부여되는 정책으로, 누가 어떤 작업을 할 수 있는지 정의

### 3-4. 그랜트(Grant)
- 일시적으로 특정 사용자/서비스에 키 사용 권한을 부여하는 기능

---

## 4. KMS 동작 원리 🔄

### 4-1. 암호화 과정
1. 사용자가 KMS에 데이터 키 생성을 요청
2. KMS는 CMK로 암호화된 데이터 키(Encrypted Data Key)와 평문 데이터 키(Plaintext Data Key)를 반환
3. 평문 데이터 키로 데이터를 암호화
4. 암호화된 데이터와 암호화된 데이터 키를 함께 저장

### 4-2. 복호화 과정
1. 암호화된 데이터 키를 KMS에 전달
2. KMS가 CMK로 복호화하여 평문 데이터 키 반환
3. 평문 데이터 키로 데이터 복호화

이렇게 하면, 실제 데이터 키는 안전하게 보호되고, 데이터 암호화/복호화도 간편하게 할 수 있습니다! 😎

---

## 5. KMS와 AWS 서비스 연동 사례 🛠️

### 5-1. S3 버킷 암호화
- S3에서 KMS 키를 선택하면, 업로드되는 객체가 자동으로 암호화됨
- S3 콘솔에서 간단히 설정 가능

### 5-2. EBS 볼륨 암호화
- EC2 인스턴스의 EBS 볼륨도 KMS로 암호화 가능
- 스냅샷, 복제본 등도 자동 암호화

### 5-3. RDS 암호화
- 데이터베이스 인스턴스 생성 시 KMS 키 지정 가능
- 백업, 스냅샷, 리스토어 등도 모두 암호화

### 5-4. Lambda 환경 변수 암호화
- Lambda 함수의 환경 변수도 KMS로 암호화하여 저장 가능

---

## 6. KMS 키의 종류와 선택 기준 🗝️

### 6-1. AWS 관리형 키(AWS Managed Key)
- AWS가 자동으로 생성/관리하는 키
- S3, EBS 등에서 기본으로 제공
- 사용자는 별도 관리 필요 없음

### 6-2. 고객 관리형 키(Customer Managed Key)
- 사용자가 직접 생성/관리하는 키
- 키 정책, 로테이션, 삭제 등 세부 설정 가능
- 보안 요구사항이 높을 때 추천

### 6-3. 대칭키 vs 비대칭키
- 대칭키: 암호화/복호화에 같은 키 사용 (일반적)
- 비대칭키: 공개키/개인키 쌍으로 암호화/복호화 (특정 시나리오에 사용)

---

## 7. KMS 사용 시 주의사항 ⚠️

### 7-1. 키 삭제는 신중하게!
- 키를 삭제하면, 해당 키로 암호화된 데이터는 영구적으로 복구 불가
- 삭제 전, 7~30일의 대기 기간(삭제 대기) 설정 가능

### 7-2. 키 로테이션(교체) 활용
- 정기적으로 키를 교체하여 보안 강화
- 고객 관리형 키는 자동 로테이션 설정 가능

### 7-3. 권한 최소화 원칙 적용
- 키에 접근할 수 있는 사용자/서비스를 최소화
- IAM, 키 정책, 그랜트 등 권한 관리 철저히!

### 7-4. CloudTrail로 모니터링
- 키 사용 이력을 CloudTrail로 모니터링하여 이상 징후 탐지

---

## 8. 실전! KMS 사용 예제 💻

### 8-1. AWS CLI로 KMS 키 생성하기
```bash
aws kms create-key --description "테스트용 KMS 키" --key-usage ENCRYPT_DECRYPT --origin AWS_KMS
```

### 8-2. 데이터 암호화/복호화
```bash
# 데이터 키 생성
aws kms generate-data-key --key-id <키ID> --key-spec AES_256

# 데이터 암호화
openssl enc -aes-256-cbc -in plain.txt -out encrypted.txt -K <PlaintextDataKey> -iv <IV>

# 데이터 키 복호화
aws kms decrypt --ciphertext-blob fileb://encrypted_data_key --output text --query Plaintext
```

### 8-3. S3 버킷에 KMS 적용하기
- S3 버킷 속성에서 "기본 암호화"를 KMS로 설정
- 객체 업로드 시 자동 암호화 적용

---

## 9. KMS의 과금 구조 💸

- 키 생성/보관: 월별로 소액 과금
- 암호화/복호화 요청: 요청 건수에 따라 과금
- AWS Free Tier: 월 20,000건 무료 제공

자세한 요금은 [AWS 공식 요금표](https://aws.amazon.com/ko/kms/pricing/) 참고!

---

## 10. KMS의 한계와 대안 🤷‍♂️

### 10-1. KMS의 한계
- 리전 단위로 키 관리 (리전 간 복제 불가)
- 대량의 암호화/복호화 요청 시 비용 증가
- 일부 특수한 암호화 요구사항은 지원하지 않음

### 10-2. 대안 서비스
- AWS CloudHSM: 하드웨어 보안 모듈 기반 키 관리
- 자체 키 관리 시스템 구축

