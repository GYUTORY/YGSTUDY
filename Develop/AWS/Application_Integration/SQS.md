---
title: AWS SQS (Simple Queue Service) 완전 가이드
tags: [aws, sqs, messaging, queue, asynchronous, serverless, microservices]
updated: 2025-09-24
---

# AWS SQS (Simple Queue Service) 완전 가이드

## 서비스 개요

AWS SQS(Simple Queue Service)는 클라우드 기반의 완전관리형 메시지 큐 서비스입니다. 이 서비스는 분산 시스템에서 비동기 메시지 처리를 위한 핵심 인프라로, 마이크로서비스 아키텍처와 서버리스 애플리케이션의 필수 구성 요소입니다.

### SQS의 핵심 가치

**완전관리형 서비스**: AWS가 인프라 관리, 확장, 모니터링을 모두 담당하여 개발팀은 비즈니스 로직에 집중할 수 있습니다.

**높은 가용성**: 99.9% 이상의 가용성을 보장하며, 여러 가용 영역에 걸쳐 메시지를 안전하게 저장합니다.

**무제한 확장성**: 처리량에 제한이 없어 트래픽 급증 시에도 자동으로 확장됩니다.

**비용 효율성**: 사용한 만큼만 비용을 지불하는 종량제 모델을 제공합니다.

## 큐 유형과 특성

### Standard Queue (표준 큐)

표준 큐는 높은 처리량과 최소한의 지연 시간을 제공하는 기본 큐 유형입니다.

**주요 특징:**
- **높은 처리량**: 초당 거의 무제한의 메시지 처리 가능
- **최소 1회 전달**: 메시지가 최소 한 번은 전달되지만, 중복 전달 가능성 존재
- **순서 보장 없음**: 메시지가 전송된 순서와 다르게 처리될 수 있음
- **최대 처리량**: 초당 거의 무제한의 트랜잭션 지원

**사용 사례:**
- 웹 애플리케이션의 백그라운드 작업 처리
- 이미지/비디오 처리 파이프라인
- 이메일 발송 시스템
- 로그 수집 및 분석

### FIFO Queue (선입선출 큐)

FIFO 큐는 메시지 순서와 중복 제거를 보장하는 고급 큐 유형입니다.

**주요 특징:**
- **순서 보장**: 메시지가 전송된 순서대로 처리됨
- **정확히 1회 전달**: 메시지 중복 없이 정확히 한 번만 전달
- **제한된 처리량**: 초당 최대 300개의 메시지 처리
- **메시지 그룹화**: MessageGroupId를 통한 병렬 처리 지원

**사용 사례:**
- 금융 거래 처리
- 주문 처리 시스템
- 데이터베이스 복제
- 중요한 비즈니스 워크플로우

## 메시지 생명주기와 처리 원칙

### 메시지 전송 과정

1. **Producer가 메시지 전송**: 애플리케이션이 SQS 큐에 메시지를 전송
2. **SQS가 메시지 저장**: 메시지가 큐에 안전하게 저장됨
3. **Consumer가 폴링**: Consumer가 주기적으로 큐를 확인하여 메시지 수신
4. **메시지 처리**: Consumer가 메시지를 처리
5. **명시적 삭제**: 처리 완료 후 Consumer가 메시지를 명시적으로 삭제

### 가시성 타임아웃 (Visibility Timeout)

메시지가 Consumer에 의해 수신되면, 다른 Consumer가 동일한 메시지를 수신하지 못하도록 일정 시간 동안 "보이지 않게" 됩니다. 이 시간을 가시성 타임아웃이라고 합니다.

**설정 원칙:**
- 메시지 처리 시간보다 충분히 길게 설정
- 너무 짧으면 중복 처리 발생 가능
- 너무 길면 처리 실패 시 재처리 지연

### Dead Letter Queue (DLQ)

처리에 실패한 메시지를 격리하는 특별한 큐입니다.

**DLQ 활용 전략:**
- 최대 수신 횟수 설정으로 무한 재시도 방지
- 실패한 메시지 분석을 통한 시스템 개선
- 수동 재처리 또는 별도 처리 파이프라인 구축

## 메시지 속성과 메타데이터

### 메시지 본문 (Message Body)
- 최대 256KB의 텍스트 데이터
- JSON, XML, 바이너리 데이터 등 다양한 형식 지원
- Base64 인코딩을 통한 바이너리 데이터 전송 가능

### 메시지 속성 (Message Attributes)
- 메시지와 함께 전송되는 메타데이터
- 문자열, 숫자, 바이너리 데이터 타입 지원
- 최대 10개의 속성, 각각 최대 256KB

### 시스템 속성
- **MessageId**: 메시지의 고유 식별자
- **ReceiptHandle**: 메시지 삭제를 위한 핸들
- **MD5OfBody**: 메시지 본문의 무결성 검증
- **Attributes**: 메시지의 시스템 메타데이터

## 성능 최적화 전략

### 장기 폴링 (Long Polling)
- 폴링 간격을 늘려 비용 절감
- 응답성 향상과 빈 응답 감소
- WaitTimeSeconds를 1-20초로 설정 권장

### 배치 작업
- 최대 10개의 메시지를 한 번에 전송/수신
- API 호출 횟수 감소로 비용 절감
- 처리량 향상

### 적절한 큐 선택
- 순서가 중요하지 않은 경우 Standard Queue 사용
- 순서와 중복 제거가 필요한 경우 FIFO Queue 사용
- 처리량 요구사항에 따른 큐 유형 선택

## 보안과 접근 제어

### IAM 정책
- 최소 권한 원칙에 따른 세밀한 권한 제어
- 큐별, 작업별 권한 분리
- 교차 계정 액세스 지원

### 서버 측 암호화 (SSE)
- 전송 중 및 저장 중 데이터 암호화
- AWS KMS를 통한 키 관리
- 암호화 키 회전 지원

### VPC 엔드포인트
- 프라이빗 네트워크를 통한 안전한 접근
- 인터넷 트래픽 없이 SQS 접근
- 네트워크 보안 강화

## 모니터링과 로깅

### CloudWatch 메트릭
- **ApproximateNumberOfMessages**: 큐에 대기 중인 메시지 수
- **ApproximateAgeOfOldestMessage**: 가장 오래된 메시지의 대기 시간
- **NumberOfMessagesSent/Received**: 메시지 전송/수신 통계
- **NumberOfEmptyReceives**: 빈 응답 횟수

### CloudTrail 로깅
- 모든 SQS API 호출 기록
- 보안 감사 및 컴플라이언스 지원
- 문제 해결을 위한 상세 로그

### 알람 설정
- 큐 깊이 임계값 설정
- 처리 실패율 모니터링
- 비용 초과 방지를 위한 알람

## 비용 최적화

### 요금 구조 이해
- 요청 기반 과금 (API 호출 횟수)
- 데이터 전송 비용
- DLQ 사용 시 추가 비용

### 비용 절감 방법
- 장기 폴링으로 API 호출 감소
- 배치 작업으로 효율성 향상
- 불필요한 큐 정리
- 적절한 메시지 보존 기간 설정

## 운영 모범 사례

### 애플리케이션 설계
- 멱등성 보장: 동일한 메시지의 중복 처리에 대비
- 오류 처리: 재시도 로직과 회로 차단기 패턴 적용
- 백프레셔: 큐 깊이에 따른 처리 속도 조절

### 큐 관리
- 정기적인 큐 상태 모니터링
- DLQ 메시지 정기 검토
- 큐 설정 최적화

### 확장성 고려사항
- Consumer 수평 확장
- 큐별 처리량 분산
- 리전별 큐 분산 고려

## 실제 사용 시나리오

### 전자상거래 주문 처리 시스템

**시나리오**: 온라인 쇼핑몰에서 주문이 들어올 때마다 재고 확인, 결제 처리, 배송 준비 등의 작업을 비동기로 처리하는 시스템

**아키텍처**:
1. 주문 API가 주문 정보를 SQS 큐에 전송
2. 재고 서비스가 큐에서 메시지를 수신하여 재고 확인
3. 결제 서비스가 결제 처리 후 배송 큐에 메시지 전송
4. 배송 서비스가 배송 준비 작업 수행

**장점**:
- 주문 API의 응답 시간 단축
- 각 서비스의 독립적 확장 가능
- 일부 서비스 장애 시에도 주문 수신 가능

### 이미지 처리 파이프라인

**시나리오**: 사용자가 업로드한 이미지를 다양한 크기로 리사이징하고 썸네일을 생성하는 시스템

**처리 과정**:
1. 이미지 업로드 시 원본 이미지 정보를 SQS에 전송
2. 이미지 처리 워커가 큐에서 작업을 수신
3. 다양한 크기로 이미지 리사이징 수행
4. 처리 완료 후 결과를 다른 큐에 전송하여 알림 발송

### 로그 수집 및 분석 시스템

**시나리오**: 여러 애플리케이션에서 발생하는 로그를 중앙에서 수집하고 실시간 분석하는 시스템

**구성 요소**:
- 로그 수집기: 각 애플리케이션의 로그를 SQS에 전송
- 로그 처리기: 큐에서 로그를 수신하여 파싱 및 정제
- 분석 엔진: 처리된 로그를 분석하여 메트릭 생성
- 알림 시스템: 이상 상황 감지 시 알림 발송

## 고급 패턴과 아키텍처

### Fan-out 패턴

하나의 메시지를 여러 큐에 동시에 전송하는 패턴입니다. SNS와 SQS를 조합하여 구현할 수 있습니다.

**사용 사례**:
- 주문 정보를 재고, 결제, 배송 큐에 동시 전송
- 사용자 활동 로그를 분석, 알림, 백업 큐에 전송

### Priority Queue 패턴

중요도에 따라 메시지 처리 순서를 조절하는 패턴입니다.

**구현 방법**:
- 여러 큐를 우선순위별로 구성
- Consumer가 높은 우선순위 큐부터 처리
- 메시지 속성에 우선순위 정보 포함

### Circuit Breaker 패턴

연속적인 실패 시 일시적으로 메시지 처리를 중단하는 패턴입니다.

**구현 요소**:
- 실패 횟수 추적
- 임계값 도달 시 회로 차단
- 복구 시도 및 회로 복구

## 문제 해결과 트러블슈팅

### 일반적인 문제들

**큐 깊이 증가**
- 원인: Consumer 처리 속도 < Producer 전송 속도
- 해결: Consumer 수평 확장, 처리 로직 최적화

**메시지 중복 처리**
- 원인: 가시성 타임아웃 설정 부적절
- 해결: 처리 시간에 맞는 타임아웃 설정, 멱등성 보장

**높은 비용**
- 원인: 과도한 API 호출, 비효율적인 폴링
- 해결: 장기 폴링 적용, 배치 작업 활용

### 모니터링 지표

**성능 지표**:
- 큐 깊이 (ApproximateNumberOfMessages)
- 메시지 처리 지연 시간
- Consumer 처리량

**비용 지표**:
- API 호출 횟수
- 데이터 전송량
- DLQ 사용량

**안정성 지표**:
- 메시지 처리 실패율
- DLQ 메시지 수
- 가시성 타임아웃 초과 횟수

## 마이그레이션 전략

### 기존 시스템에서 SQS 도입

**단계별 접근**:
1. 새로운 기능에 SQS 적용
2. 기존 시스템의 일부 기능을 SQS로 이전
3. 점진적으로 전체 시스템 마이그레이션

**고려사항**:
- 기존 메시지 큐와의 호환성
- 데이터 마이그레이션 계획
- 다운타임 최소화 방안

### 하이브리드 아키텍처

**온프레미스와 클라우드 연동**:
- VPN 또는 Direct Connect를 통한 연결
- 하이브리드 메시지 브로커 활용
- 데이터 동기화 전략 수립

## 참조

- AWS SQS 개발자 가이드: https://docs.aws.amazon.com/ko_kr/AWSSimpleQueueService/latest/SQSDeveloperGuide/
- AWS Well-Architected Framework - 메시징: https://docs.aws.amazon.com/wellarchitected/latest/reliability-pillar/messaging.html
- AWS SQS 모범 사례: https://docs.aws.amazon.com/ko_kr/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-best-practices.html
- 마이크로서비스 패턴 - 메시징: https://microservices.io/patterns/communication-style/messaging.html
- 분산 시스템 설계 원칙: https://martinfowler.com/articles/distributed-objects-microservices.html
