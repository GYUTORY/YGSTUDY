
## TLS 핸드셰이크란 무엇일까요?

![TLS_HandShake.md.png](..%2F..%2F..%2F..%2F..%2Fetc%2Fimage%2FNetwork_image%2F7Layer%2FHttp%2FTLS_HandShake.md.png)
- TLS 핸드셰이크는 [TLS](..%2F..%2FTransport%20Layer%2FTLS%20%26%20SSL.md) 암호화를 사용하는 통신 세션을 실행하는 프로세스입니다.
- TLS 핸드셰이크 중에, 통신하는 양측에서는 메시지를 교환하여 서로를 인식하고 서로를 검증하며 사용할 암호화 알고리즘을 구성하고 세션 키에 합의합니다.
- TLS 핸드셰이크는 HTTPS 작동 원리의 근간을 이룹니다.

--- 

### TLS 핸드셰이크와 SSL 핸드셰이크
- 보안 소켓 계층(SSL)은 원래 HTTP용으로 개발된 암호화 프로토콜이었습니다.
- SSL은 안전성과 보안 측면에서 여러 취약점을 가지고 있어, 전송 계층 보안(TLS) 프로토콜로 대체되었습니다.

--- 

### TLS 핸드셰이크는 언제 발생할까요?
- TLS 핸드셰이크는 사용자가 HTTPS를 통해 웹 사이트를 탐색하고 브라우저가 처음 해당 웹 사이트의 원본 서버를 쿼리하기 시작할 때마다 발생합니다. 
- 다른 통신이 API 호출 및 HTTPS를 통한 DNS 쿼리를 포함하는 HTTPS를 사용할 때에도 매번 TLS 핸드셰이크가 발생합니다.
- TLS 핸드셰이크는 TCP 연결이 TCP 핸드셰이크를 통해 열린 후에 발생합니다.

--- 

### TLS 핸드셰이크가 이루어지는 단계는 어떻게 될까요?
- TLS 핸드셰이크는 클라이언트와 서버가 교환하는 일련의 데이터그램, 즉 메시지입니다. TLS 핸드셰이크는 여러 단계로 이루어집니다. 
- 그 과정에서 클라이언트와 서버는 핸드셰이크를 완료하고 추가 대화를 가능하게 하는 데 필요한 정보를 교환합니다.

![TLS Flow.png](..%2F..%2F..%2F..%2F..%2Fetc%2Fimage%2FNetwork_image%2F7Layer%2FHttp%2FTLS%20Flow.png)

#### 1. '클라이언트 헬로' 메시지
- 클라이언트가 먼저 서버에 접속해서 말을 겁니다. (Client Hello)

#### 2. '서버 헬로' 메시지
- 서버는 클라이언트의 인사에 응답하며, 필요한 정보를 제공합니다.

#### 3. 브라우저는 서버의 SSL 인증서가 믿을만한지 확인합니다.
- 클라이언트가 서버의 SSL 인증서를 인증서 발행 기관을 통해 검증합니다. 이를 통해 서버가 인증서에 명시된 서버인지, 그리고 클라이언트가 상호작용 중인 서버가 실제 해당 도메인의 소유자인지를 확인합니다.

#### 4. 예비 마스터 암호
- 클라이언트가 "예비 마스터 암호"라고 하는 무작위 바이트 문자열을 하나 더 전송합니다. 예비 마스터 암호는 공개 키로 암호화되어 있으며, 서버가 개인 키로만 해독할 수 있습니다. (클라이언트는 서버의 SSL 인증서를 통해 공개 키를 받습니다.)

#### 5. 서버는 브라우저가 보낸 예비 마스터 암호 값을 복호화합니다.
- 서버가 예비 마스터 암호를 해독하여, master key를 저장하고 연결에 고유한 값을 부여하기 위한 session key를 생성합니다.

#### 6. 서버/클라이언트) SSL HandShake를 종료하고, HTTPS 통신을 시작한다.

---
```
출처
1. https://www.cloudflare.com/ko-kr/learning/ssl/what-happens-in-a-tls-handshake/
2. https://brunch.co.kr/@sangjinkang/38
```

